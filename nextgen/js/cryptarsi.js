/**
 * Created by delian on 8/30/16.
 */
"use strict";
/*
 * This little module should implement Base64 encoding/decoding with auto detect between nodejs and browser
 */
// <reference path="./typings/index.d.ts" />
var B2A = function (b) {
    return new Buffer(b).toString('base64');
};
if (typeof btoa == 'function')
    B2A = btoa;
var A2B = function (a) {
    return new Buffer(a, 'base64').toString('ascii');
};
if (typeof atob == 'function')
    A2B = atob;
var Base64 = (function () {
    function Base64() {
    }
    Base64.btoa = function (b) {
        return B2A(b);
    };
    Base64.atob = function (a) {
        return A2B(a);
    };
    return Base64;
}());
exports.Base64 = Base64;

/**
 * Created by delian on 8/30/16.
 */
"use strict";
var config = require('./config.json');
var Config = (function () {
    function Config() {
    }
    Config.get = function (key) {
        return config[key];
    };
    return Config;
}());
exports.Config = Config;

/**
 * Created by delian on 8/19/16.
 */
/// <reference path="./typings/index.d.ts" />
"use strict";
var gPassword = null;
var gNonce = null;
// TODO: To implement the Nonce
var Crypto = (function () {
    function Crypto(password, nonce) {
        gPassword = password;
    }
    Crypto.prototype.decrypt = function (data, password, nonce) {
        if (password === void 0) { password = gPassword; }
        if (nonce === void 0) { nonce = gNonce; }
        return CryptoJS.AES.decrypt(data, password).toString();
    };
    Crypto.prototype.encrypt = function (data, password, nonce) {
        if (password === void 0) { password = gPassword; }
        if (nonce === void 0) { nonce = gNonce; }
        return CryptoJS.AES.encrypt(data, password).toString();
    };
    Crypto.prototype.setPassword = function (password) {
        gPassword = password;
    };
    Crypto.prototype.setNonce = function (nonce) {
        gNonce = nonce;
    };
    Crypto.prototype.dhs = function (word) {
        return this.encrypt(word);
    };
    return Crypto;
}());
exports.Crypto = Crypto;

/**
 * Created by delian on 8/30/16.
 */
"use strict";
var UriLoad = (function () {
    function UriLoad() {
        this.req = null;
        this.req = new XMLHttpRequest();
    }
    UriLoad.prototype.get = function (uri, cb) {
        this.req.open('GET', uri, false);
        this.req.send(null);
        if (this.req.status == 200 || this.req.status == 0) {
            return cb(null, this.req);
        }
        else {
            return cb(new Error('Problem'), this.req);
        }
    };
    UriLoad.prototype.get = function (uri, cb) {
        this.req.open('GET', uri, false);
        this.req.send(null);
        if (this.req.status == 200 || this.req.status == 0) {
            var resp = this.req.responseXML.documentElement;
            var field = resp.getElementsByTagName("data");
            for (var i = 0; i < field.length; i++) {
                try {
                    var key = field[i].getElementsByTagName("key")[0].textContent;
                    var val = field[i].getElementsByTagName("value")[0].textContent;
                    this.store(key, val);
                }
                catch (e) {
                }
            }
        }
    };
    return UriLoad;
}());
exports.UriLoad = UriLoad;

/**
 * Created by delian on 8/30/16.
 */
"use strict";
var __extends = (this && this.__extends) || function (d, b) {
    for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p];
    function __() { this.constructor = d; }
    d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());
};
var Crypto_1 = require('./Crypto');
var WordHash = (function (_super) {
    __extends(WordHash, _super);
    function WordHash() {
        _super.apply(this, arguments);
    }
    WordHash.prototype.hash = function (word) {
        return word.toLowerCase().match(/^.{2,15}/)[0];
    };
    WordHash.prototype.d2h = function (d) {
        return d.toString(16);
    };
    WordHash.prototype.h2d = function (h) {
        return parseInt(h, 16);
    };
    WordHash.prototype.s2h = function (s) {
        var cr = "";
        for (var i = 0; i < s.length; i++)
            cr = cr + this.d2h(s.charCodeAt(i));
        return cr;
    };
    return WordHash;
}(Crypto_1.Crypto));
exports.WordHash = WordHash;

/**
 * Created by delian on 8/19/16.
 */
"use strict";
var UriLoad_1 = require('./UriLoad');
var WordHash_1 = require('./WordHash');
var net = new UriLoad_1.UriLoad();
var wh = new WordHash_1.WordHash('', ''); // TODO: Password storage should be implemented
var Storage = (function () {
    function Storage() {
    }
    Storage.prototype.clear = function () {
        localStorage.clear();
    };
    Storage.prototype.loadFromURI = function (uri) {
        this.clear();
    };
    Storage.prototype.getData = function (key) {
        return localStorage[key];
    };
    Storage.prototype.setData = function (key, val) {
        localStorage[key] = val;
        return val;
    };
    Storage.prototype.lstr = function (x, cb) {
        var my = this;
        if (this.getData(x))
            return true;
        var file = wh.s2h(x);
        var dir = file.substr(-3, 3);
        var fn = "index/" + dir + "/file" + file + ".txt";
        net.get(fn, function (err, req) {
            var z = req.responseText;
            my.setData(x, z.replace(/\<xml\>/, "").replace(/\<\/xml\>/, ""));
            if (my.getData(x))
                return cb(null);
            return cb(new Error());
        });
        return false;
    };
    return Storage;
}());
exports.Storage = Storage;

/**
 * Created by delian on 8/19/16.
 */
"use strict";
var Crypto_1 = require('./Crypto');
var crypt = new Crypto_1.Crypto('parola', 'nonce'); //TODO: password store
var Search = (function () {
    function Search() {
    }
    Search.prototype.setextr = function (w) {
        var d = dhs(w + ".idx");
        if (lstr(d)) {
            var s = Aes.Ctr.decrypt(localStorage[d], pass2, 256);
            return s.split(",");
        }
        else
            return [];
    };
    Search.prototype.crossset = function (w, s) {
        var a = [];
        for (var i = s.length - 1; i >= 0; i--)
            if (w.indexOf(s[i]) >= 0)
                a.push(s[i]);
        return a;
    };
    Search.prototype.notcrossset = function (w, s) {
        var a = w;
        for (var i = s.length - 1; i >= 0; i--)
            if (a.indexOf(s[i]) >= 0)
                a.splice(a.indexOf(s[i]), 1);
        return a;
    };
    Search.prototype.andNot = function (words, isnt) {
        if (isnt === void 0) { isnt = false; }
        function branchLen(text) {
            var words = text.replace(/^\s+/, "").replace(/\s+$/, "");
            var i;
            var count;
            if (words.charAt(0) != '(')
                return text.length;
            for (i = 1, count = 1; count && i < words.length; i++) {
                count += (words.charAt(i) == '(') ? 1 : 0;
                count -= (words.charAt(i) == ')') ? 1 : 0;
            }
            return i;
        }
        function mixout(a, b) {
            if (typeof a != 'object' || typeof b != 'object' || typeof a.and != 'object' || typeof a.not != 'object' || typeof b.and != 'object' || typeof b.not != 'object')
                return a;
            Object.keys(b.and).forEach(function (n) { a.and[n] = b.and[n]; });
            Object.keys(b.not).forEach(function (n) { a.not[n] = b.not[n]; });
            return a;
        }
        var out;
        var out2;
        if (typeof words != 'string' || words == '')
            return { and: {}, not: {} };
        words = words.replace(/^\s+/, "").replace(/\s+$/, "");
        if (words.length == 0)
            return { and: {}, not: {} };
        //console.log('Words',words);
        if (words.charAt(0) == '(') {
            var blen = branchLen(words);
            var myset = words.substr(0, blen);
            var outset = words.substr(blen);
            myset = myset.replace(/^\(/, "").replace(/\)$/, "");
            out = this.andNot(myset);
            out2 = this.andNot(outset);
            return mixout(isnt ? { and: out.not, not: out.and } : out, out2);
        }
        if (words.charAt(0) == '-') {
            return this.andNot(words.substr(1), isnt ? false : true);
        }
        if (words.charAt(0) == '+')
            return this.andNot(words.substr(1), isnt);
        var x = words.match(/^(\S+)(.+)?$/);
        var y = {};
        if (x == null)
            return { and: {}, not: {} };
        y[x[1]] = 1;
        return mixout(isnt ? { and: {}, not: y } : { and: y, not: {} }, this.andNot(x[2]));
    };
    Search.prototype.coRegexProc = function (words) {
        if (typeof words != 'string' || words == '')
            return [];
        words = words.replace(/^\s+/, "").replace(/\s+$/, []);
        if (words.length == 0)
            return [];
        function regexArray(words) {
            var w = words;
            var pushA = [];
            function splitPush(words, inv) {
                if (inv === void 0) { inv = false; }
                while (words.match(/[\+\-]/)) {
                    words = words.replace(/^\s+/, "").replace(/\s+$/, "");
                    if (!words.match(/^[\+\-]/))
                        words = words.replace(/^(.+?)([\+\-])/, function (m, a, p) {
                            pushA.push({ match: inv ? "-" : "+", string: a });
                            return p;
                        });
                    words = words.replace(/^([\+\-])(\S+)?/, function (m, p, a) {
                        pushA.push({ match: (((inv ? 1 : 0) ^ (p != '-' ? 1 : 0)) ? "+" : "-"), string: a });
                        return "";
                    });
                }
                if (words)
                    pushA.push({ match: (inv ? "-" : "+"), string: words });
            }
            function branches() {
                w = w.replace(/([\+\-]?)\((.+?)\)/g, function (m, p, a) {
                    splitPush(a, p == '-');
                    return "";
                });
            }
            branches();
            splitPush(w);
            pushA.forEach(function (n) { n.string = n.string.replace(/^\s+/, "").replace(/\s+$/, "").replace(/[\s\!-\/\:-\@\[-\]\'\{-~]+/g, ".*"); n.regex = new RegExp(n.string, "i"); });
            return pushA;
        }
        return regexArray(words);
    };
    Search.prototype.searchRule = function (srch) {
        var out = this.andNot(srch);
        if (Object.keys(out.and).length == 0)
            return [];
        var w = Object.keys(out.and).concat(Object.keys(out.not)).sort(function (x, y) { return x.length <= y.length ? 1 : 0; });
        var w1 = Object.keys(out.and).sort(function (x, y) { return x.length <= y.length ? 1 : 0; });
        w.unshift(w.splice(w.indexOf(w1[0]), 1)[0]); // Put the largest AND word at the front
        var myset = setextr(myhash(w[0]));
        for (var i = 1; i < w.length && (myset.length >= (w.length - i)); i++)
            myset = (out.and[w[i]]) ? crossset(myset, setextr(myhash(w[i]))) : notcrossset(myset, setextr(myhash(w[i])));
        // Now we have a set with probable matching, lets do the second match
        var outset = [];
        var regArray = this.coRegexProc(srch);
        var fullStrings = srch.match(/([\+\-])?\"(.+?)\"/g);
        if (fullStrings) {
            fullStrings.forEach(function (n) {
                var o = { match: '+', string: '' };
                if (n.match(/^\-/))
                    o.match = '-';
                o.string = n.replace(/^[\+\-]?\"/, "").replace(/\"$/, "").replace(/[\s\!-\/\:-\@\[-\]\'\{-~]+/g, "[\\s\\!-\\/\\:-\\@\\[-\\]\\'\\{-~]*");
                o.regex = new RegExp(o.string, "i");
                regArray.unshift(o);
            });
        }
        myset.forEach(function (n) {
            var s = trd(n + ".data");
            // Stings match
            for (var i = 0; i < regArray.length; i++) {
                var t = regArray[i].regex.test(s);
                if (t && regArray[i].match == '-')
                    return;
                if ((!t) && regArray[i].match == '+')
                    return;
            }
            outset.push(n);
        });
        return outset;
    };
    return Search;
}());
exports.Search = Search;

/**
 * Created by delian on 8/18/16.
 */

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIkJhc2U2NC50cyIsIkNvbmZpZy50cyIsIkNyeXB0by50cyIsIlVyaUxvYWQudHMiLCJXb3JkSGFzaC50cyIsIlN0b3JhZ2UudHMiLCJTZWFyY2gudHMiLCJtYWluLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBOztHQUVHOztBQUVIOztHQUVHO0FBRUgsNENBQTRDO0FBRTVDLElBQUksR0FBRyxHQUFHLFVBQVMsQ0FBUTtJQUN2QixNQUFNLENBQUMsSUFBSSxNQUFNLENBQUMsQ0FBQyxDQUFDLENBQUMsUUFBUSxDQUFDLFFBQVEsQ0FBQyxDQUFDO0FBQzVDLENBQUMsQ0FBQztBQUNGLEVBQUUsQ0FBQyxDQUFDLE9BQU8sSUFBSSxJQUFJLFVBQVUsQ0FBQztJQUFDLEdBQUcsR0FBRyxJQUFJLENBQUM7QUFFMUMsSUFBSSxHQUFHLEdBQUcsVUFBUyxDQUFRO0lBQ3ZCLE1BQU0sQ0FBQyxJQUFJLE1BQU0sQ0FBQyxDQUFDLEVBQUMsUUFBUSxDQUFDLENBQUMsUUFBUSxDQUFDLE9BQU8sQ0FBQyxDQUFDO0FBQ3BELENBQUMsQ0FBQztBQUNGLEVBQUUsQ0FBQyxDQUFDLE9BQU8sSUFBSSxJQUFJLFVBQVUsQ0FBQztJQUFDLEdBQUcsR0FBRyxJQUFJLENBQUM7QUFFMUM7SUFBQTtJQU9BLENBQUM7SUFOVSxXQUFJLEdBQVgsVUFBWSxDQUFRO1FBQ2hCLE1BQU0sQ0FBQyxHQUFHLENBQUMsQ0FBQyxDQUFDLENBQUM7SUFDbEIsQ0FBQztJQUNNLFdBQUksR0FBWCxVQUFZLENBQVE7UUFDaEIsTUFBTSxDQUFDLEdBQUcsQ0FBQyxDQUFDLENBQUMsQ0FBQztJQUNsQixDQUFDO0lBQ0wsYUFBQztBQUFELENBUEEsQUFPQyxJQUFBO0FBUFksY0FBTSxTQU9sQixDQUFBOztBQzNCRDs7R0FFRzs7QUFRSCxJQUFJLE1BQU0sR0FBRyxPQUFPLENBQUMsZUFBZSxDQUFDLENBQUM7QUFFdEM7SUFDSTtJQUVBLENBQUM7SUFFTSxVQUFHLEdBQVYsVUFBVyxHQUFVO1FB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Q0FBQyxJQUFJLENBQUMsR0FBRyxDQUFDLEdBQUcsQ0FBQyxDQUFDLE1BQU0sSUFBRSxDQUFDLENBQUM7WUFBQyxNQUFNLENBQUMsRUFBRSxDQUFDO1FBQzlDLElBQUksQ0FBQyxHQUFHLE1BQU0sQ0FBQyxJQUFJLENBQUMsR0FBRyxDQUFDLEdBQUcsQ0FBQyxDQUFDLE1BQU0sQ0FBQyxNQUFNLENBQUMsSUFBSSxDQUFDLEdBQUcsQ0FBQyxHQUFHLENBQUMsQ0FBQyxDQUFDLElBQUksQ0FBQyxVQUFDLENBQVEsRUFBQyxDQUFRLElBQVksTUFBTSxDQUFDLENBQUMsQ0FBQyxNQUFNLElBQUUsQ0FBQyxDQUFDLE1BQU0sR0FBQyxDQUFDLEdBQUMsQ0FBQyxDQUFBLENBQUMsQ0FBQyxDQUFDLENBQUM7UUFDOUgsSUFBSSxFQUFFLEdBQUcsTUFBTSxDQUFDLElBQUksQ0FBQyxHQUFHLENBQUMsR0FBRyxDQUFDLENBQUMsSUFBSSxDQUFDLFVBQUMsQ0FBUSxFQUFDLENBQVEsSUFBWSxNQUFNLENBQUMsQ0FBQyxDQUFDLE1BQU0sSUFBRSxDQUFDLENBQUMsTUFBTSxHQUFDLENBQUMsR0FBQyxDQUFDLENBQUEsQ0FBQyxDQUFDLENBQUMsQ0FBQztRQUVsRyxDQUFDLENBQUMsT0FBTyxDQUFDLENBQUMsQ0FBQyxNQUFNLENBQUMsQ0FBQyxDQUFDLE9BQU8sQ0FBQyxFQUFFLENBQUMsQ0FBQyxDQUFDLENBQUMsRUFBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsd0NBQXdDO1FBRXBGLElBQUksS0FBSyxHQUFHLE9BQU8sQ0FBQyxNQUFNLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQztRQUNsQyxHQUFHLENBQUMsQ0FBQyxJQUFJLENBQUMsR0FBVSxDQUFDLEVBQUUsQ0FBQyxHQUFHLENBQUMsQ0FBQyxNQUFNLElBQUssQ0FBQyxLQUFLLENBQUMsTUFBTSxJQUFJLENBQUMsQ0FBQyxDQUFDLE1BQU0sR0FBQyxDQUFDLENBQUMsQ0FBQyxFQUFFLENBQUMsRUFBRTtZQUFFLEtBQUssR0FBRyxDQUFDLEdBQUcsQ0FBQyxHQUFHLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsR0FBQyxRQUFRLENBQUMsS0FBSyxFQUFFLE9BQU8sQ0FBQyxNQUFNLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxHQUFDLFdBQVcsQ0FBQyxLQUFLLEVBQUUsT0FBTyxDQUFDLE1BQU0sQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUM7UUFFdEwscUVBQXFFO1FBRXJFLElBQUksTUFBTSxHQUFHLEVBQUUsQ0FBQztRQUNoQixJQUFJLFFBQVEsR0FBRyxJQUFJLENBQUMsV0FBVyxDQUFDLElBQUksQ0FBQyxDQUFDO1FBRXRDLElBQUksV0FBVyxHQUFHLElBQUksQ0FBQyxLQUFLLENBQUMscUJBQXFCLENBQUMsQ0FBQztRQUNwRCxFQUFFLENBQUMsQ0FBQyxXQUFXLENBQUMsQ0FBQyxDQUFDO1lBQ2QsV0FBVyxDQUFDLE9BQU8sQ0FBQyxVQUFTLENBQUM7Z0JBQzFCLElBQUksQ0FBQyxHQUFVLEVBQUUsS0FBSyxFQUFFLEdBQUcsRUFBRSxNQUFNLEVBQUUsRUFBRSxFQUFFLENBQUM7Z0JBQzFDLEVBQUUsQ0FBQyxDQUFDLENBQUMsQ0FBQyxLQUFLLENBQUMsS0FBSyxDQUFDLENBQUM7b0JBQUMsQ0FBQyxDQUFDLEtBQUssR0FBRyxHQUFHLENBQUM7Z0JBQ2xDLENBQUMsQ0FBQyxNQUFNLEdBQUcsQ0FBQyxDQUFDLE9BQU8sQ0FBQyxZQUFZLEVBQUMsRUFBRSxDQUFDLENBQUMsT0FBTyxDQUFDLEtBQUssRUFBQyxFQUFFLENBQUMsQ0FBQyxPQUFPLENBQUMsNkJBQTZCLEVBQUMscUNBQXFDLENBQUMsQ0FBQztnQkFDckksQ0FBQyxDQUFDLEtBQUssR0FBRyxJQUFJLE1BQU0sQ0FBQyxDQUFDLENBQUMsTUFBTSxFQUFDLEdBQUcsQ0FBQyxDQUFDO2dCQUNuQyxRQUFRLENBQUMsT0FBTyxDQUFDLENBQUMsQ0FBQyxDQUFDO1lBQ3hCLENBQUMsQ0FBQyxDQUFBO1FBQ04sQ0FBQztRQUVELEtBQUssQ0FBQyxPQUFPLENBQUMsVUFBUyxDQUFDO1lBQ3BCLElBQUksQ0FBQyxHQUFHLEdBQUcsQ0FBQyxDQUFDLEdBQUMsT0FBTyxDQUFDLENBQUM7WUFFdkIsZUFBZTtZQUdmLEdBQUcsQ0FBQyxDQUFDLElBQUksQ0FBQyxHQUFDLENBQUMsRUFBQyxDQUFDLEdBQUMsUUFBUSxDQUFDLE1BQU0sRUFBQyxDQUFDLEVBQUUsRUFBRSxDQUFDO2dCQUNqQyxJQUFJLENBQUMsR0FBRyxRQUFRLENBQUMsQ0FBQyxDQUFDLENBQUMsS0FBSyxDQUFDLElBQUksQ0FBQyxDQUFDLENBQUMsQ0FBQztnQkFDbEMsRUFBRSxDQUFDLENBQUMsQ0FBQyxJQUFJLFFBQVEsQ0FBQyxDQUFDLENBQUMsQ0FBQyxLQUFLLElBQUksR0FBRyxDQUFDO29CQUFDLE1BQU0sQ0FBQztnQkFDMUMsRUFBRSxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxJQUFJLFFBQVEsQ0FBQyxDQUFDLENBQUMsQ0FBQyxLQUFLLElBQUksR0FBRyxDQUFDO29CQUFDLE1BQU0sQ0FBQztZQUNqRCxDQUFDO1lBQ0QsTUFBTSxDQUFDLElBQUksQ0FBQyxDQUFDLENBQUMsQ0FBQztRQUNuQixDQUFDLENBQUMsQ0FBQztRQUVILE1BQU0sQ0FBQyxNQUFNLENBQUM7SUFDbEIsQ0FBQztJQUdMLGFBQUM7QUFBRCxDQXZLQSxBQXVLQyxJQUFBO0FBdktZLGNBQU0sU0F1S2xCLENBQUE7O0FDM0xEOztHQUVHIiwiZmlsZSI6ImNyeXB0YXJzaS5qcyIsInNvdXJjZXNDb250ZW50IjpbIi8qKlxuICogQ3JlYXRlZCBieSBkZWxpYW4gb24gOC8zMC8xNi5cbiAqL1xuXG4vKlxuICogVGhpcyBsaXR0bGUgbW9kdWxlIHNob3VsZCBpbXBsZW1lbnQgQmFzZTY0IGVuY29kaW5nL2RlY29kaW5nIHdpdGggYXV0byBkZXRlY3QgYmV0d2VlbiBub2RlanMgYW5kIGJyb3dzZXJcbiAqL1xuXG4vLyA8cmVmZXJlbmNlIHBhdGg9XCIuL3R5cGluZ3MvaW5kZXguZC50c1wiIC8+XG5cbnZhciBCMkEgPSBmdW5jdGlvbihiOnN0cmluZyk6IHN0cmluZyB7XG4gICAgcmV0dXJuIG5ldyBCdWZmZXIoYikudG9TdHJpbmcoJ2Jhc2U2NCcpO1xufTtcbmlmICh0eXBlb2YgYnRvYSA9PSAnZnVuY3Rpb24nKSBCMkEgPSBidG9hO1xuXG52YXIgQTJCID0gZnVuY3Rpb24oYTpzdHJpbmcpOiBzdHJpbmcge1xuICAgIHJldHVybiBuZXcgQnVmZmVyKGEsJ2Jhc2U2NCcpLnRvU3RyaW5nKCdhc2NpaScpO1xufTtcbmlmICh0eXBlb2YgYXRvYiA9PSAnZnVuY3Rpb24nKSBBMkIgPSBhdG9iO1xuXG5leHBvcnQgY2xhc3MgQmFzZTY0IHtcbiAgICBzdGF0aWMgYnRvYShiOnN0cmluZyk6c3RyaW5nIHtcbiAgICAgICAgcmV0dXJuIEIyQShiKTtcbiAgICB9XG4gICAgc3RhdGljIGF0b2IoYTpzdHJpbmcpOnN0cmluZyB7XG4gICAgICAgIHJldHVybiBBMkIoYSk7XG4gICAgfVxufSIsIi8qKlxuICogQ3JlYXRlZCBieSBkZWxpYW4gb24gOC8zMC8xNi5cbiAqL1xuXG5kZWNsYXJlIHZhciByZXF1aXJlOiB7XG4gICAgPFQ+KHBhdGg6IHN0cmluZyk6IFQ7XG4gICAgKHBhdGhzOiBzdHJpbmdbXSwgY2FsbGJhY2s6ICguLi5tb2R1bGVzOiBhbnlbXSkgPT4gdm9pZCk6IHZvaWQ7XG4gICAgZW5zdXJlOiAocGF0aHM6IHN0cmluZ1tdLCBjYWxsYmFjazogKHJlcXVpcmU6IDxUPihwYXRoOiBzdHJpbmcpID0+IFQpID0+IHZvaWQpID0+IHZvaWQ7XG59O1xuXG52YXIgY29uZmlnID0gcmVxdWlyZSgnLi9jb25maWcuanNvbicpO1xuXG5leHBvcnQgY2xhc3MgQ29uZmlnIHtcbiAgICBjb25zdHJ1Y3RvcigpIHtcblxuICAgIH1cblxuICAgIHN0YXRpYyBnZXQoa2V5OnN0cmluZyk6c3RyaW5nIHtcbiAgICAgICAgcmV0dXJuIGNvbmZpZ1trZXldO1xuICAgIH1cbn1cbiIsIi8qKlxuICogQ3JlYXRlZCBieSBkZWxpYW4gb24gOC8xOS8xNi5cbiAqL1xuLy8vIDxyZWZlcmVuY2UgcGF0aD1cIi4vdHlwaW5ncy9pbmRleC5kLnRzXCIgLz5cblxudmFyIGdQYXNzd29yZDpzdHJpbmcgPSBudWxsO1xudmFyIGdOb25jZTpzdHJpbmcgPSBudWxsO1xuXG4vLyBUT0RPOiBUbyBpbXBsZW1lbnQgdGhlIE5vbmNlXG5cbmV4cG9ydCBjbGFzcyBDcnlwdG8ge1xuXG4gICAgY29uc3RydWN0b3IocGFzc3dvcmQ6IHN0cmluZywgbm9uY2U6IHN0cmluZykge1xuICAgICAgICBnUGFzc3dvcmQgPSBwYXNzd29yZDtcbiAgICB9XG5cbiAgICBkZWNyeXB0KGRhdGE6IHN0cmluZywgcGFzc3dvcmQ6c3RyaW5nID0gZ1Bhc3N3b3JkLCBub25jZTpzdHJpbmcgPSBnTm9uY2UpOiBzdHJpbmcge1xuICAgICAgICByZXR1cm4gQ3J5cHRvSlMuQUVTLmRlY3J5cHQoZGF0YSwgcGFzc3dvcmQpLnRvU3RyaW5nKCk7XG4gICAgfVxuXG4gICAgZW5jcnlwdChkYXRhOiBzdHJpbmcsIHBhc3N3b3JkOnN0cmluZyA9IGdQYXNzd29yZCwgbm9uY2U6c3RyaW5nID0gZ05vbmNlKTogc3RyaW5nIHtcbiAgICAgICAgcmV0dXJuIENyeXB0b0pTLkFFUy5lbmNyeXB0KGRhdGEsIHBhc3N3b3JkKS50b1N0cmluZygpO1xuICAgIH1cblxuICAgIHNldFBhc3N3b3JkKHBhc3N3b3JkOnN0cmluZykge1xuICAgICAgICBnUGFzc3dvcmQgPSBwYXNzd29yZDtcbiAgICB9XG5cbiAgICBzZXROb25jZShub25jZTpzdHJpbmcpIHtcbiAgICAgICAgZ05vbmNlID0gbm9uY2U7XG4gICAgfVxuXG4gICAgZGhzKHdvcmQ6IHN0cmluZyk6IHN0cmluZyB7XG4gICAgICAgIHJldHVybiB0aGlzLmVuY3J5cHQod29yZCk7XG4gICAgfVxufVxuXG4iLCIvKipcbiAqIENyZWF0ZWQgYnkgZGVsaWFuIG9uIDgvMzAvMTYuXG4gKi9cblxuaW1wb3J0IHtDb25maWd9IGZyb20gJy4vQ29uZmlnJztcblxuZXhwb3J0IGNsYXNzIFVyaUxvYWQge1xuICAgIHJlcTogWE1MSHR0cFJlcXVlc3QgPSBudWxsO1xuXG4gICAgY29uc3RydWN0b3IoKSB7XG4gICAgICAgIHRoaXMucmVxID0gbmV3IFhNTEh0dHBSZXF1ZXN0KCk7XG4gICAgfVxuXG4gICAgZ2V0KHVyaTpzdHJpbmcsIGNiOkZ1bmN0aW9uKTp2b2lkIHtcbiAgICAgICAgdGhpcy5yZXEub3BlbignR0VUJywgdXJpLCBmYWxzZSk7XG4gICAgICAgIHRoaXMucmVxLnNlbmQobnVsbCk7XG4gICAgICAgIGlmICh0aGlzLnJlcS5zdGF0dXMgPT0gMjAwIHx8IHRoaXMucmVxLnN0YXR1cyA9PSAwKSB7XG4gICAgICAgICAgICByZXR1cm4gY2IobnVsbCx0aGlzLnJlcSk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICByZXR1cm4gY2IobmV3IEVycm9yKCdQcm9ibGVtJyksdGhpcy5yZXEpO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgZ2V0KHVyaTpzdHJpbmcsIGNiOiBGdW5jdGlvbikge1xuICAgICAgICB0aGlzLnJlcS5vcGVuKCdHRVQnLCB1cmksIGZhbHNlKTtcbiAgICAgICAgdGhpcy5yZXEuc2VuZChudWxsKTtcbiAgICAgICAgaWYgKHRoaXMucmVxLnN0YXR1cyA9PSAyMDAgfHwgdGhpcy5yZXEuc3RhdHVzID09IDApIHtcbiAgICAgICAgICAgIHZhciByZXNwID0gdGhpcy5yZXEucmVzcG9uc2VYTUwuZG9jdW1lbnRFbGVtZW50O1xuICAgICAgICAgICAgdmFyIGZpZWxkID0gcmVzcC5nZXRFbGVtZW50c0J5VGFnTmFtZShcImRhdGFcIik7XG4gICAgICAgICAgICBmb3IgKHZhciBpPTA7IGk8ZmllbGQubGVuZ3RoO2krKykge1xuICAgICAgICAgICAgICAgIHRyeSB7XG4gICAgICAgICAgICAgICAgICAgIHZhciBrZXk6c3RyaW5nID0gZmllbGRbaV0uZ2V0RWxlbWVudHNCeVRhZ05hbWUoXCJrZXlcIilbMF0udGV4dENvbnRlbnQ7XG4gICAgICAgICAgICAgICAgICAgIHZhciB2YWw6c3RyaW5nID0gZmllbGRbaV0uZ2V0RWxlbWVudHNCeVRhZ05hbWUoXCJ2YWx1ZVwiKVswXS50ZXh0Q29udGVudDtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5zdG9yZShrZXksdmFsKTtcbiAgICAgICAgICAgICAgICB9IGNhdGNoKGUpIHtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICB9XG59XG4iLCIvKipcbiAqIENyZWF0ZWQgYnkgZGVsaWFuIG9uIDgvMzAvMTYuXG4gKi9cblxuaW1wb3J0IHtDcnlwdG99IGZyb20gJy4vQ3J5cHRvJztcblxuZXhwb3J0IGNsYXNzIFdvcmRIYXNoIGV4dGVuZHMgQ3J5cHRvIHtcblxuICAgIGhhc2god29yZDpzdHJpbmcpOnN0cmluZyB7XG4gICAgICAgIHJldHVybiB3b3JkLnRvTG93ZXJDYXNlKCkubWF0Y2goL14uezIsMTV9LylbMF07XG4gICAgfVxuXG4gICAgZDJoKGQ6bnVtYmVyKTpzdHJpbmcgeyAvLyBDb252ZXJ0IHRvIEhFWFxuICAgICAgICByZXR1cm4gZC50b1N0cmluZygxNik7XG4gICAgfVxuXG4gICAgaDJkKGg6c3RyaW5nKTpudW1iZXIgeyAvLyBDb252ZXJ0IHRvIE51bVxuICAgICAgICByZXR1cm4gcGFyc2VJbnQoaCwxNik7XG4gICAgfVxuXG4gICAgczJoKHM6IHN0cmluZyk6c3RyaW5nIHsgLy8gU3RyaW5nIHRvIEhFWFxuICAgICAgICB2YXIgY3I6c3RyaW5nID0gXCJcIjtcbiAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBzLmxlbmd0aDsgaSsrKSBjciA9IGNyICsgdGhpcy5kMmgocy5jaGFyQ29kZUF0KGkpKTtcbiAgICAgICAgcmV0dXJuIGNyO1xuICAgIH1cblxufVxuIiwiLyoqXG4gKiBDcmVhdGVkIGJ5IGRlbGlhbiBvbiA4LzE5LzE2LlxuICovXG5cbmltcG9ydCB7VXJpTG9hZH0gZnJvbSAnLi9VcmlMb2FkJztcbmltcG9ydCB7V29yZEhhc2h9IGZyb20gJy4vV29yZEhhc2gnO1xuXG52YXIgbmV0ID0gbmV3IFVyaUxvYWQoKTtcbnZhciB3aCA9IG5ldyBXb3JkSGFzaCgnJywnJyk7IC8vIFRPRE86IFBhc3N3b3JkIHN0b3JhZ2Ugc2hvdWxkIGJlIGltcGxlbWVudGVkXG5cbmV4cG9ydCBjbGFzcyBTdG9yYWdlIHtcbiAgICBjb25zdHJ1Y3RvcigpIHtcbiAgICB9XG5cbiAgICBjbGVhcigpIHtcbiAgICAgICAgbG9jYWxTdG9yYWdlLmNsZWFyKCk7XG4gICAgfVxuXG4gICAgbG9hZEZyb21VUkkodXJpKSB7XG4gICAgICAgIHRoaXMuY2xlYXIoKTtcbiAgICB9XG5cbiAgICBnZXREYXRhKGtleTpzdHJpbmcpOiBzdHJpbmcge1xuICAgICAgICByZXR1cm4gbG9jYWxTdG9yYWdlW2tleV07XG4gICAgfVxuXG4gICAgc2V0RGF0YShrZXk6c3RyaW5nLCB2YWw6c3RyaW5nKTpzdHJpbmcge1xuICAgICAgICBsb2NhbFN0b3JhZ2Vba2V5XT12YWw7XG4gICAgICAgIHJldHVybiB2YWw7XG4gICAgfVxuXG4gICAgbHN0cih4OiBzdHJpbmcsIGNiOiBGdW5jdGlvbik6Ym9vbGVhbiB7IC8vIFRPRE86IGxzdHIgbXVzdCBiZWNvbWUgd2l0aCBjYWxsYmFja1xuICAgICAgICB2YXIgbXkgPSB0aGlzO1xuICAgICAgICBpZiAodGhpcy5nZXREYXRhKHgpKSByZXR1cm4gdHJ1ZTtcbiAgICAgICAgdmFyIGZpbGUgPSB3aC5zMmgoeCk7XG4gICAgICAgIHZhciBkaXIgPSBmaWxlLnN1YnN0cigtMywgMyk7XG4gICAgICAgIHZhciBmbiA9IFwiaW5kZXgvXCIgKyBkaXIgKyBcIi9maWxlXCIgKyBmaWxlICsgXCIudHh0XCI7XG4gICAgICAgIG5ldC5nZXQoZm4sZnVuY3Rpb24oZXJyLHJlcSkge1xuICAgICAgICAgICAgdmFyIHogPSByZXEucmVzcG9uc2VUZXh0O1xuICAgICAgICAgICAgbXkuc2V0RGF0YSh4LHoucmVwbGFjZSgvXFw8eG1sXFw+LywgXCJcIikucmVwbGFjZSgvXFw8XFwveG1sXFw+LywgXCJcIikpO1xuICAgICAgICAgICAgaWYgKG15LmdldERhdGEoeCkpIHJldHVybiBjYihudWxsKTtcbiAgICAgICAgICAgIHJldHVybiBjYihuZXcgRXJyb3IoKSk7XG4gICAgICAgIH0pO1xuICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgfVxufVxuIiwiLyoqXG4gKiBDcmVhdGVkIGJ5IGRlbGlhbiBvbiA4LzE5LzE2LlxuICovXG5cbmltcG9ydCB7Q3J5cHRvfSBmcm9tICcuL0NyeXB0byc7XG5pbXBvcnQge1N0b3JhZ2V9IGZyb20gJy4vU3RvcmFnZSc7XG5cbnZhciBjcnlwdCA9IG5ldyBDcnlwdG8oJ3Bhcm9sYScsJ25vbmNlJyk7IC8vVE9ETzogcGFzc3dvcmQgc3RvcmVcblxuaW50ZXJmYWNlIElBbmROb3Qge1xuICAgIG5vdDogYW55LFxuICAgIGFuZDogYW55XG59XG5cbmludGVyZmFjZSBJUHVzaEEge1xuICAgIG1hdGNoOiBhbnksXG4gICAgc3RyaW5nOiBzdHJpbmcsXG4gICAgcmVnZXg/OiBhbnlcbn1cblxuZXhwb3J0IGNsYXNzIFNlYXJjaCB7XG4gICAgY29uc3RydWN0b3IoKSB7XG5cbiAgICB9XG5cbiAgICBzZXRleHRyKHc6IHN0cmluZyk6c3RyaW5nW10ge1xuICAgICAgICB2YXIgZCA9IGRocyh3ICsgXCIuaWR4XCIpO1xuICAgICAgICBpZiAobHN0cihkKSkge1xuICAgICAgICAgICAgdmFyIHMgPSBBZXMuQ3RyLmRlY3J5cHQobG9jYWxTdG9yYWdlW2RdLCBwYXNzMiwgMjU2KTtcbiAgICAgICAgICAgIHJldHVybiBzLnNwbGl0KFwiLFwiKVxuICAgICAgICB9XG4gICAgICAgIGVsc2UgcmV0dXJuIFtdO1xuICAgIH1cblxuICAgIGNyb3Nzc2V0KHc6IHN0cmluZ1tdLCBzOiBzdHJpbmdbXSk6IHN0cmluZ1tdIHtcbiAgICAgICAgbGV0IGE6IHN0cmluZ1tdID0gW107XG4gICAgICAgIGZvciAobGV0IGk6bnVtYmVyID0gcy5sZW5ndGgtMTsgaT49MDsgaS0tKSBpZiAody5pbmRleE9mKHNbaV0pPj0wKSBhLnB1c2goc1tpXSk7XG4gICAgICAgIHJldHVybiBhO1xuICAgIH1cblxuICAgIG5vdGNyb3Nzc2V0KHc6IHN0cmluZ1tdLCBzOiBzdHJpbmdbXSk6IHN0cmluZ1tdIHtcbiAgICAgICAgbGV0IGE6IHN0cmluZ1tdID0gdztcbiAgICAgICAgZm9yIChsZXQgaTpudW1iZXIgPSBzLmxlbmd0aC0xOyBpID49IDA7IGktLSkgaWYgKGEuaW5kZXhPZihzW2ldKT49MCkgYS5zcGxpY2UoYS5pbmRleE9mKHNbaV0pLDEpO1xuICAgICAgICByZXR1cm4gYTtcbiAgICB9XG5cbiAgICBhbmROb3Qod29yZHM6IHN0cmluZywgaXNudDogYm9vbGVhbiA9IGZhbHNlKTogSUFuZE5vdCB7XG5cbiAgICAgICAgZnVuY3Rpb24gYnJhbmNoTGVuKHRleHQ6IHN0cmluZyk6IG51bWJlciB7XG4gICAgICAgICAgICB2YXIgd29yZHM6IHN0cmluZyA9IHRleHQucmVwbGFjZSgvXlxccysvLCBcIlwiKS5yZXBsYWNlKC9cXHMrJC8sIFwiXCIpO1xuICAgICAgICAgICAgdmFyIGk6IG51bWJlcjtcbiAgICAgICAgICAgIHZhciBjb3VudDogbnVtYmVyO1xuXG4gICAgICAgICAgICBpZiAod29yZHMuY2hhckF0KDApIT0nKCcpIHJldHVybiB0ZXh0Lmxlbmd0aDtcbiAgICAgICAgICAgIGZvciAoaT0xLGNvdW50PTE7IGNvdW50JiZpPHdvcmRzLmxlbmd0aDsgaSsrKSB7XG4gICAgICAgICAgICAgICAgY291bnQrPSh3b3Jkcy5jaGFyQXQoaSk9PScoJyk/MTowO1xuICAgICAgICAgICAgICAgIGNvdW50LT0od29yZHMuY2hhckF0KGkpPT0nKScpPzE6MDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHJldHVybiBpO1xuICAgICAgICB9XG5cbiAgICAgICAgZnVuY3Rpb24gbWl4b3V0KGE6SUFuZE5vdCxiOklBbmROb3QpOklBbmROb3Qge1xuICAgICAgICAgICAgaWYgKHR5cGVvZiBhICE9ICdvYmplY3QnIHx8IHR5cGVvZiBiICE9ICdvYmplY3QnIHx8IHR5cGVvZiBhLmFuZCAhPSAnb2JqZWN0JyB8fCB0eXBlb2YgYS5ub3QgIT0gJ29iamVjdCcgfHwgdHlwZW9mIGIuYW5kICE9ICdvYmplY3QnIHx8IHR5cGVvZiBiLm5vdCAhPSAnb2JqZWN0JykgcmV0dXJuIGE7XG4gICAgICAgICAgICBPYmplY3Qua2V5cyhiLmFuZCkuZm9yRWFjaChmdW5jdGlvbihuKSB7YS5hbmRbbl09IGIuYW5kW25dfSk7XG4gICAgICAgICAgICBPYmplY3Qua2V5cyhiLm5vdCkuZm9yRWFjaChmdW5jdGlvbihuKSB7YS5ub3Rbbl09IGIubm90W25dfSk7XG4gICAgICAgICAgICByZXR1cm4gYTtcbiAgICAgICAgfVxuXG4gICAgICAgIHZhciBvdXQ6SUFuZE5vdDtcbiAgICAgICAgdmFyIG91dDI6SUFuZE5vdDtcbiAgICAgICAgaWYgKHR5cGVvZiB3b3JkcyAhPSAnc3RyaW5nJyB8fCB3b3JkcyA9PSAnJykgcmV0dXJuIHsgYW5kOiB7fSwgbm90OiB7fSB9O1xuXG4gICAgICAgIHdvcmRzID0gd29yZHMucmVwbGFjZSgvXlxccysvLCBcIlwiKS5yZXBsYWNlKC9cXHMrJC8sIFwiXCIpO1xuICAgICAgICBpZiAod29yZHMubGVuZ3RoPT0wKSByZXR1cm4geyBhbmQ6IHt9LCBub3Q6IHt9IH07XG4gICAgICAgIC8vY29uc29sZS5sb2coJ1dvcmRzJyx3b3Jkcyk7XG5cbiAgICAgICAgaWYgKHdvcmRzLmNoYXJBdCgwKSA9PSAnKCcpIHtcbiAgICAgICAgICAgIHZhciBibGVuID0gYnJhbmNoTGVuKHdvcmRzKTtcbiAgICAgICAgICAgIHZhciBteXNldCA9IHdvcmRzLnN1YnN0cigwLGJsZW4pO1xuICAgICAgICAgICAgdmFyIG91dHNldCA9IHdvcmRzLnN1YnN0cihibGVuKTtcbiAgICAgICAgICAgIG15c2V0ID0gbXlzZXQucmVwbGFjZSgvXlxcKC8sXCJcIikucmVwbGFjZSgvXFwpJC8sXCJcIik7XG4gICAgICAgICAgICBvdXQgPSB0aGlzLmFuZE5vdChteXNldCk7XG4gICAgICAgICAgICBvdXQyID0gdGhpcy5hbmROb3Qob3V0c2V0KTtcbiAgICAgICAgICAgIHJldHVybiBtaXhvdXQoaXNudD97IGFuZDogb3V0Lm5vdCwgbm90OiBvdXQuYW5kIH06b3V0LG91dDIpO1xuICAgICAgICB9XG5cbiAgICAgICAgaWYgKHdvcmRzLmNoYXJBdCgwKSA9PSAnLScpIHsgLy8gSW52ZXJzZVxuICAgICAgICAgICAgcmV0dXJuIHRoaXMuYW5kTm90KHdvcmRzLnN1YnN0cigxKSxpc250P2ZhbHNlOnRydWUpO1xuICAgICAgICB9XG5cbiAgICAgICAgaWYgKHdvcmRzLmNoYXJBdCgwKSA9PSAnKycpIHJldHVybiB0aGlzLmFuZE5vdCh3b3Jkcy5zdWJzdHIoMSksaXNudCk7XG5cbiAgICAgICAgdmFyIHggPSB3b3Jkcy5tYXRjaCgvXihcXFMrKSguKyk/JC8pO1xuICAgICAgICB2YXIgeSA9IHt9O1xuICAgICAgICBpZiAoeD09bnVsbCkgcmV0dXJuIHsgYW5kOiB7fSwgbm90OiB7fSB9O1xuICAgICAgICB5W3hbMV1dPTE7XG4gICAgICAgIHJldHVybiBtaXhvdXQoaXNudD97IGFuZDoge30gLCBub3Q6IHkgfTp7IGFuZDogeSwgbm90OiB7fSB9LHRoaXMuYW5kTm90KHhbMl0pKTtcbiAgICB9XG5cbiAgICBjb1JlZ2V4UHJvYyh3b3JkczpzdHJpbmcpOklQdXNoQVtdIHtcbiAgICAgICAgaWYgKHR5cGVvZiB3b3JkcyAhPSAnc3RyaW5nJyB8fCB3b3JkcyA9PSAnJykgcmV0dXJuIFtdO1xuICAgICAgICB3b3JkcyA9IHdvcmRzLnJlcGxhY2UoL15cXHMrLywgXCJcIikucmVwbGFjZSgvXFxzKyQvLCBbXSk7XG4gICAgICAgIGlmICh3b3Jkcy5sZW5ndGg9PTApIHJldHVybiBbXTtcblxuICAgICAgICBmdW5jdGlvbiByZWdleEFycmF5KHdvcmRzOnN0cmluZyk6SVB1c2hBW10ge1xuICAgICAgICAgICAgdmFyIHc6c3RyaW5nID0gd29yZHM7XG4gICAgICAgICAgICB2YXIgcHVzaEE6SVB1c2hBW10gPSBbXTtcblxuICAgICAgICAgICAgZnVuY3Rpb24gc3BsaXRQdXNoKHdvcmRzOnN0cmluZyxpbnY6Ym9vbGVhbj1mYWxzZSk6dm9pZCB7XG4gICAgICAgICAgICAgICAgd2hpbGUod29yZHMubWF0Y2goL1tcXCtcXC1dLykpIHtcbiAgICAgICAgICAgICAgICAgICAgd29yZHMgPSB3b3Jkcy5yZXBsYWNlKC9eXFxzKy8sXCJcIikucmVwbGFjZSgvXFxzKyQvLFwiXCIpO1xuICAgICAgICAgICAgICAgICAgICBpZiAoIXdvcmRzLm1hdGNoKC9eW1xcK1xcLV0vKSkgd29yZHMgPSB3b3Jkcy5yZXBsYWNlKC9eKC4rPykoW1xcK1xcLV0pLyxmdW5jdGlvbihtLGEscCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgcHVzaEEucHVzaCh7IG1hdGNoOiBpbnY/XCItXCI6XCIrXCIsIHN0cmluZzogYSB9KTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBwO1xuICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICAgICAgd29yZHMgPSB3b3Jkcy5yZXBsYWNlKC9eKFtcXCtcXC1dKShcXFMrKT8vLGZ1bmN0aW9uKG0scCxhKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBwdXNoQS5wdXNoKHsgbWF0Y2g6ICgoKGludj8xOjApXihwIT0nLSc/MTowKSk/XCIrXCI6XCItXCIpLCBzdHJpbmc6IGF9KTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBcIlwiO1xuICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgaWYgKHdvcmRzKSBwdXNoQS5wdXNoKHttYXRjaDooaW52P1wiLVwiOlwiK1wiKSwgc3RyaW5nOndvcmRzfSk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGZ1bmN0aW9uIGJyYW5jaGVzKCkge1xuICAgICAgICAgICAgICAgIHc9dy5yZXBsYWNlKC8oW1xcK1xcLV0/KVxcKCguKz8pXFwpL2csZnVuY3Rpb24obSxwLGEpIHtcbiAgICAgICAgICAgICAgICAgICAgc3BsaXRQdXNoKGEscD09Jy0nKTtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIFwiXCI7XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGJyYW5jaGVzKCk7XG4gICAgICAgICAgICBzcGxpdFB1c2godyk7XG5cbiAgICAgICAgICAgIHB1c2hBLmZvckVhY2goZnVuY3Rpb24obikge24uc3RyaW5nID0gbi5zdHJpbmcucmVwbGFjZSgvXlxccysvLFwiXCIpLnJlcGxhY2UoL1xccyskLyxcIlwiKS5yZXBsYWNlKC9bXFxzXFwhLVxcL1xcOi1cXEBcXFstXFxdXFwnXFx7LX5dKy9nLFwiLipcIik7bi5yZWdleCA9IG5ldyBSZWdFeHAobi5zdHJpbmcsXCJpXCIpOyB9KTtcblxuICAgICAgICAgICAgcmV0dXJuIHB1c2hBO1xuICAgICAgICB9XG5cbiAgICAgICAgcmV0dXJuIHJlZ2V4QXJyYXkod29yZHMpO1xuICAgIH1cblxuICAgIHNlYXJjaFJ1bGUoc3JjaDogc3RyaW5nKTogc3RyaW5nW10ge1xuICAgICAgICB2YXIgb3V0ID0gdGhpcy5hbmROb3Qoc3JjaCk7XG5cbiAgICAgICAgaWYgKE9iamVjdC5rZXlzKG91dC5hbmQpLmxlbmd0aD09MCkgcmV0dXJuIFtdO1xuICAgICAgICB2YXIgdyA9IE9iamVjdC5rZXlzKG91dC5hbmQpLmNvbmNhdChPYmplY3Qua2V5cyhvdXQubm90KSkuc29ydCgoeDpzdHJpbmcseTpzdHJpbmcpOm51bWJlcj0+eyByZXR1cm4geC5sZW5ndGg8PXkubGVuZ3RoPzE6MCB9KTtcbiAgICAgICAgdmFyIHcxID0gT2JqZWN0LmtleXMob3V0LmFuZCkuc29ydCgoeDpzdHJpbmcseTpzdHJpbmcpOm51bWJlcj0+eyByZXR1cm4geC5sZW5ndGg8PXkubGVuZ3RoPzE6MCB9KTtcblxuICAgICAgICB3LnVuc2hpZnQody5zcGxpY2Uody5pbmRleE9mKHcxWzBdKSwxKVswXSk7IC8vIFB1dCB0aGUgbGFyZ2VzdCBBTkQgd29yZCBhdCB0aGUgZnJvbnRcblxuICAgICAgICB2YXIgbXlzZXQgPSBzZXRleHRyKG15aGFzaCh3WzBdKSk7XG4gICAgICAgIGZvciAobGV0IGk6bnVtYmVyID0gMTsgaSA8IHcubGVuZ3RoICAmJiAobXlzZXQubGVuZ3RoID49ICh3Lmxlbmd0aC1pKSk7IGkrKykgbXlzZXQgPSAob3V0LmFuZFt3W2ldXSk/Y3Jvc3NzZXQobXlzZXQsIHNldGV4dHIobXloYXNoKHdbaV0pKSk6bm90Y3Jvc3NzZXQobXlzZXQsIHNldGV4dHIobXloYXNoKHdbaV0pKSk7XG5cbiAgICAgICAgLy8gTm93IHdlIGhhdmUgYSBzZXQgd2l0aCBwcm9iYWJsZSBtYXRjaGluZywgbGV0cyBkbyB0aGUgc2Vjb25kIG1hdGNoXG5cbiAgICAgICAgdmFyIG91dHNldCA9IFtdO1xuICAgICAgICB2YXIgcmVnQXJyYXkgPSB0aGlzLmNvUmVnZXhQcm9jKHNyY2gpO1xuXG4gICAgICAgIHZhciBmdWxsU3RyaW5ncyA9IHNyY2gubWF0Y2goLyhbXFwrXFwtXSk/XFxcIiguKz8pXFxcIi9nKTtcbiAgICAgICAgaWYgKGZ1bGxTdHJpbmdzKSB7XG4gICAgICAgICAgICBmdWxsU3RyaW5ncy5mb3JFYWNoKGZ1bmN0aW9uKG4pIHtcbiAgICAgICAgICAgICAgICB2YXIgbzpJUHVzaEEgPSB7IG1hdGNoOiAnKycsIHN0cmluZzogJycgfTtcbiAgICAgICAgICAgICAgICBpZiAobi5tYXRjaCgvXlxcLS8pKSBvLm1hdGNoID0gJy0nO1xuICAgICAgICAgICAgICAgIG8uc3RyaW5nID0gbi5yZXBsYWNlKC9eW1xcK1xcLV0/XFxcIi8sXCJcIikucmVwbGFjZSgvXFxcIiQvLFwiXCIpLnJlcGxhY2UoL1tcXHNcXCEtXFwvXFw6LVxcQFxcWy1cXF1cXCdcXHstfl0rL2csXCJbXFxcXHNcXFxcIS1cXFxcL1xcXFw6LVxcXFxAXFxcXFstXFxcXF1cXFxcJ1xcXFx7LX5dKlwiKTtcbiAgICAgICAgICAgICAgICBvLnJlZ2V4ID0gbmV3IFJlZ0V4cChvLnN0cmluZyxcImlcIik7XG4gICAgICAgICAgICAgICAgcmVnQXJyYXkudW5zaGlmdChvKTtcbiAgICAgICAgICAgIH0pXG4gICAgICAgIH1cblxuICAgICAgICBteXNldC5mb3JFYWNoKGZ1bmN0aW9uKG4pIHtcbiAgICAgICAgICAgIHZhciBzID0gdHJkKG4rXCIuZGF0YVwiKTtcblxuICAgICAgICAgICAgLy8gU3RpbmdzIG1hdGNoXG5cblxuICAgICAgICAgICAgZm9yICh2YXIgaT0wO2k8cmVnQXJyYXkubGVuZ3RoO2krKykge1xuICAgICAgICAgICAgICAgIHZhciB0ID0gcmVnQXJyYXlbaV0ucmVnZXgudGVzdChzKTtcbiAgICAgICAgICAgICAgICBpZiAodCAmJiByZWdBcnJheVtpXS5tYXRjaCA9PSAnLScpIHJldHVybjtcbiAgICAgICAgICAgICAgICBpZiAoKCF0KSAmJiByZWdBcnJheVtpXS5tYXRjaCA9PSAnKycpIHJldHVybjtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIG91dHNldC5wdXNoKG4pO1xuICAgICAgICB9KTtcblxuICAgICAgICByZXR1cm4gb3V0c2V0O1xuICAgIH1cblxuXG59IiwiLyoqXG4gKiBDcmVhdGVkIGJ5IGRlbGlhbiBvbiA4LzE4LzE2LlxuICovXG4iXSwic291cmNlUm9vdCI6Ii9zb3VyY2UvIn0=

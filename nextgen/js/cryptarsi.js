/**
 * Created by delian on 8/30/16.
 */
"use strict";
/*
 * This little module should implement Base64 encoding/decoding with auto detect between nodejs and browser
 */
// <reference path="./typings/index.d.ts" />
var B2A = function (b) {
    return new Buffer(b).toString('base64');
};
if (typeof btoa == 'function')
    B2A = btoa;
var A2B = function (a) {
    return new Buffer(a, 'base64').toString('ascii');
};
if (typeof atob == 'function')
    A2B = atob;
var Base64 = (function () {
    function Base64() {
    }
    Base64.btoa = function (b) {
        return B2A(b);
    };
    Base64.atob = function (a) {
        return A2B(a);
    };
    return Base64;
}());
exports.Base64 = Base64;

/**
 * Created by delian on 8/30/16.
 */
"use strict";
var config = require('./config.json');
var Config = (function () {
    function Config() {
    }
    Config.get = function (key) {
        return config[key];
    };
    return Config;
}());
exports.Config = Config;

/**
 * Created by delian on 8/30/16.
 */
"use strict";
var WordHash = (function () {
    function WordHash() {
    }
    WordHash.hash = function (word) {
        return word.toLowerCase().match(/^.{2,15}/)[0];
    };
    WordHash.d2h = function (d) {
        return d.toString(16);
    };
    WordHash.h2d = function (h) {
        return parseInt(h, 16);
    };
    WordHash.s2h = function (s) {
        var cr = "";
        for (var i = 0; i < s.length; i++)
            cr = cr + this.d2h(s.charCodeAt(i));
        return cr;
    };
    return WordHash;
}());
exports.WordHash = WordHash;

/**
 * Created by delian on 8/19/16.
 */
/// <reference path="./typings/index.d.ts" />
"use strict";
var WordHash_1 = require("./WordHash");
var gPassword = null;
var gNonce = null;
// TODO: To implement the Nonce
var Crypto = (function () {
    function Crypto(password, nonce) {
        gPassword = password;
    }
    Crypto.prototype.hash = function (word) {
        return WordHash_1.WordHash.hash(word);
    };
    Crypto.prototype.decrypt = function (data, password, nonce) {
        if (password === void 0) { password = gPassword; }
        if (nonce === void 0) { nonce = gNonce; }
        return CryptoJS.AES.decrypt(data, password).toString();
    };
    Crypto.prototype.encrypt = function (data, password, nonce) {
        if (password === void 0) { password = gPassword; }
        if (nonce === void 0) { nonce = gNonce; }
        return CryptoJS.AES.encrypt(data, password).toString();
    };
    Crypto.prototype.setPassword = function (password) {
        gPassword = password;
    };
    Crypto.prototype.setNonce = function (nonce) {
        gNonce = nonce;
    };
    Crypto.prototype.dhs = function (word) {
        return this.encrypt(word);
    };
    return Crypto;
}());
exports.Crypto = Crypto;

/**
 * Created by delian on 8/30/16.
 */
"use strict";
var es6_promise_1 = require('es6-promise');
var UriLoad = (function () {
    function UriLoad() {
        this.req = null;
        this.req = new XMLHttpRequest();
    }
    UriLoad.prototype.get = function (uri) {
        var me = this;
        return new es6_promise_1.Promise(function (resolve, reject) {
            me.req.open('GET', uri, true);
            me.req.onload = function (e) {
                if (me.req.readyState == 4) {
                    if (me.req.status == 200 || me.req.status == 201 || me.req.status == 0) {
                        resolve(me.req);
                    }
                }
            };
            me.req.onerror = function (e) {
                reject(me.req);
            };
            me.req.send(null);
        });
    };
    return UriLoad;
}());
exports.UriLoad = UriLoad;

/**
 * Created by delian on 8/19/16.
 */
"use strict";
/// <reference path="./typings/index.d.ts" />
var UriLoad_1 = require('./UriLoad');
var WordHash_1 = require('./WordHash');
var Crypto_1 = require('./Crypto');
var es6_promise_1 = require('es6-promise');
var Storage = (function () {
    function Storage() {
        this.net = new UriLoad_1.UriLoad();
        this.crypto = new Crypto_1.Crypto('', ''); // TODO: Fix the password
    }
    Storage.prototype.clear = function () {
        localStorage.clear();
    };
    Storage.prototype.loadFromURI = function (uri) {
        this.clear();
    };
    Storage.prototype.getDataLS = function (key) {
        return localStorage[key];
    };
    Storage.prototype.setDataLS = function (key, val) {
        localStorage[key] = val;
        return val;
    };
    Storage.prototype.getData = function (key) {
        var me = this;
        return new es6_promise_1.Promise(function (resolve, reject) {
            resolve(me.getDataLS(key));
        });
    };
    Storage.prototype.setData = function (key, val) {
        var me = this;
        return new es6_promise_1.Promise(function (resolve, reject) {
            resolve(me.setDataLS(key, val));
        });
    };
    Storage.prototype.lstr = function (x, cb) {
        var my = this;
        if (this.getData(x))
            return true;
        var file = WordHash_1.WordHash.s2h(x);
        var dir = file.substr(-3, 3);
        var fn = "index/" + dir + "/file" + file + ".txt";
        net.get(fn, function (err, req) {
            var z = req.responseText;
            my.setData(x, z.replace(/\<xml\>/, "").replace(/\<\/xml\>/, ""));
            if (my.getData(x))
                return cb(null);
            return cb(new Error());
        });
        return false;
    };
    Storage.prototype.setextr = function (w, cb) {
        var d = crypto.dhs(w + ".idx");
        this.lstr(d, function (err, data) {
            if (err)
                cb(err, []);
            var s = crypto.decrypt(this.getData(d)); // TODO: Storage has to become async
            return cb(null, s.split(","));
        });
    };
    return Storage;
}());
exports.Storage = Storage;

/**
 * Created by delian on 10/2/16.
 */
"use strict";
/// <reference path="./typings/index.d.ts" />
/*
This class has a goal to load the database in the storage
 */
// TODO: make the code more sequential with Promises. Could use Promises.all
var UriLoad_1 = require('./UriLoad');
var Storage_1 = require('./Storage');
var es6_promise_1 = require('es6-promise');
var LoadDB = (function () {
    function LoadDB() {
        this.uriReq = new UriLoad_1.UriLoad();
        this.storage = new Storage_1.Storage();
    }
    /**
     * Loads data from a predefined URL and stores it in the storage
     * @param uri
     * @returns {"es6-promise".Promise}
     */
    LoadDB.prototype.load = function (uri) {
        var me = this;
        return new es6_promise_1.Promise(function (resolve, reject) {
            me.uriReq.get(uri).then(function (req) {
                var resp = req.responseXML.documentElement;
                var field = resp.getElementsByTagName("data");
                for (var i = 0; i < field.length; i++) {
                    try {
                        var key = field[i].getElementsByTagName("key")[0].textContent;
                        var val = field[i].getElementsByTagName("value")[0].textContent;
                        me.storage.setData(key, val).catch(reject); // No problem it could execute out of order
                    }
                    catch (e) { }
                }
                return resolve();
            }).catch(reject);
        });
    };
    return LoadDB;
}());

/**
 * Created by delian on 8/19/16.
 */
"use strict";
var Crypto_1 = require('./Crypto');
var Storage_1 = require('./Storage');
var WordHash_1 = require('./WordHash');
var crypt = new Crypto_1.Crypto('parola', 'nonce'); //TODO: password store
var storage = new Storage_1.Storage();
var Search = (function () {
    function Search() {
    }
    Search.prototype.crossset = function (w, s) {
        var a = [];
        for (var i = s.length - 1; i >= 0; i--)
            if (w.indexOf(s[i]) >= 0)
                a.push(s[i]);
        return a;
    };
    Search.prototype.notcrossset = function (w, s) {
        var a = w;
        for (var i = s.length - 1; i >= 0; i--)
            if (a.indexOf(s[i]) >= 0)
                a.splice(a.indexOf(s[i]), 1);
        return a;
    };
    Search.prototype.andNot = function (words, isnt) {
        if (isnt === void 0) { isnt = false; }
        function branchLen(text) {
            var words = text.replace(/^\s+/, "").replace(/\s+$/, "");
            var i;
            var count;
            if (words.charAt(0) != '(')
                return text.length;
            for (i = 1, count = 1; count && i < words.length; i++) {
                count += (words.charAt(i) == '(') ? 1 : 0;
                count -= (words.charAt(i) == ')') ? 1 : 0;
            }
            return i;
        }
        function mixout(a, b) {
            if (typeof a != 'object' || typeof b != 'object' || typeof a.and != 'object' || typeof a.not != 'object' || typeof b.and != 'object' || typeof b.not != 'object')
                return a;
            Object.keys(b.and).forEach(function (n) { a.and[n] = b.and[n]; });
            Object.keys(b.not).forEach(function (n) { a.not[n] = b.not[n]; });
            return a;
        }
        var out;
        var out2;
        if (typeof words != 'string' || words == '')
            return { and: {}, not: {} };
        words = words.replace(/^\s+/, "").replace(/\s+$/, "");
        if (words.length == 0)
            return { and: {}, not: {} };
        //console.log('Words',words);
        if (words.charAt(0) == '(') {
            var blen = branchLen(words);
            var myset = words.substr(0, blen);
            var outset = words.substr(blen);
            myset = myset.replace(/^\(/, "").replace(/\)$/, "");
            out = this.andNot(myset);
            out2 = this.andNot(outset);
            return mixout(isnt ? { and: out.not, not: out.and } : out, out2);
        }
        if (words.charAt(0) == '-') {
            return this.andNot(words.substr(1), isnt ? false : true);
        }
        if (words.charAt(0) == '+')
            return this.andNot(words.substr(1), isnt);
        var x = words.match(/^(\S+)(.+)?$/);
        var y = {};
        if (x == null)
            return { and: {}, not: {} };
        y[x[1]] = 1;
        return mixout(isnt ? { and: {}, not: y } : { and: y, not: {} }, this.andNot(x[2]));
    };
    Search.prototype.coRegexProc = function (words) {
        if (typeof words != 'string' || words == '')
            return [];
        words = words.replace(/^\s+/, "").replace(/\s+$/, []);
        if (words.length == 0)
            return [];
        function regexArray(words) {
            var w = words;
            var pushA = [];
            function splitPush(words, inv) {
                if (inv === void 0) { inv = false; }
                while (words.match(/[\+\-]/)) {
                    words = words.replace(/^\s+/, "").replace(/\s+$/, "");
                    if (!words.match(/^[\+\-]/))
                        words = words.replace(/^(.+?)([\+\-])/, function (m, a, p) {
                            pushA.push({ match: inv ? "-" : "+", string: a });
                            return p;
                        });
                    words = words.replace(/^([\+\-])(\S+)?/, function (m, p, a) {
                        pushA.push({ match: (((inv ? 1 : 0) ^ (p != '-' ? 1 : 0)) ? "+" : "-"), string: a });
                        return "";
                    });
                }
                if (words)
                    pushA.push({ match: (inv ? "-" : "+"), string: words });
            }
            function branches() {
                w = w.replace(/([\+\-]?)\((.+?)\)/g, function (m, p, a) {
                    splitPush(a, p == '-');
                    return "";
                });
            }
            branches();
            splitPush(w);
            pushA.forEach(function (n) { n.string = n.string.replace(/^\s+/, "").replace(/\s+$/, "").replace(/[\s\!-\/\:-\@\[-\]\'\{-~]+/g, ".*"); n.regex = new RegExp(n.string, "i"); });
            return pushA;
        }
        return regexArray(words);
    };
    Search.prototype.searchRule = function (srch) {
        var out = this.andNot(srch);
        if (Object.keys(out.and).length == 0)
            return [];
        var w = Object.keys(out.and).concat(Object.keys(out.not)).sort(function (x, y) { return x.length <= y.length ? 1 : 0; });
        var w1 = Object.keys(out.and).sort(function (x, y) { return x.length <= y.length ? 1 : 0; });
        w.unshift(w.splice(w.indexOf(w1[0]), 1)[0]); // Put the largest AND word at the front
        var myset = storage.setextr(WordHash_1.WordHash.hash(w[0]), function () {
        });
        for (var i = 1; i < w.length && (myset.length >= (w.length - i)); i++)
            myset = (out.and[w[i]]) ? crossset(myset, setextr(myhash(w[i]))) : notcrossset(myset, setextr(myhash(w[i])));
        // Now we have a set with probable matching, lets do the second match
        var outset = [];
        var regArray = this.coRegexProc(srch);
        var fullStrings = srch.match(/([\+\-])?\"(.+?)\"/g);
        if (fullStrings) {
            fullStrings.forEach(function (n) {
                var o = { match: '+', string: '' };
                if (n.match(/^\-/))
                    o.match = '-';
                o.string = n.replace(/^[\+\-]?\"/, "").replace(/\"$/, "").replace(/[\s\!-\/\:-\@\[-\]\'\{-~]+/g, "[\\s\\!-\\/\\:-\\@\\[-\\]\\'\\{-~]*");
                o.regex = new RegExp(o.string, "i");
                regArray.unshift(o);
            });
        }
        myset.forEach(function (n) {
            var s = trd(n + ".data");
            // Stings match
            for (var i = 0; i < regArray.length; i++) {
                var t = regArray[i].regex.test(s);
                if (t && regArray[i].match == '-')
                    return;
                if ((!t) && regArray[i].match == '+')
                    return;
            }
            outset.push(n);
        });
        return outset;
    };
    return Search;
}());
exports.Search = Search;

/**
 * Created by delian on 8/18/16.
 */

//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIkJhc2U2NC50cyIsIkNvbmZpZy50cyIsIldvcmRIYXNoLnRzIiwiQ3J5cHRvLnRzIiwiVXJpTG9hZC50cyIsIlN0b3JhZ2UudHMiLCJMb2FkREIudHMiLCJTZWFyY2gudHMiLCJtYWluLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBOztHQUVHOztBQUVIOztHQUVHO0FBRUgsNENBQTRDO0FBRTVDLElBQUksR0FBRyxHQUFHLFVBQVMsQ0FBUTtJQUN2QixNQUFNLENBQUMsSUFBSSxNQUFNLENBQUMsQ0FBQyxDQUFDLENBQUMsUUFBUSxDQUFDLFFBQVEsQ0FBQyxDQUFDO0FBQzVDLENBQUMsQ0FBQztBQUNGLEVBQUUsQ0FBQyxDQUFDLE9BQU8sSUFBSSxJQUFJLFVBQVUsQ0FBQztJQUFDLEdBQUcsR0FBRyxJQUFJLENBQUM7QUFFMUMsSUFBSSxHQUFHLEdBQUcsVUFBUyxDQUFRO0lBQ3ZCLE1BQU0sQ0FBQyxJQUFJLE1BQU0sQ0FBQyxDQUFDLEVBQUMsUUFBUSxDQUFDLENBQUMsUUFBUSxDQUFDLE9BQU8sQ0FBQyxDQUFDO0FBQ3BELENBQUMsQ0FBQztBQUNGLEVBQUUsQ0FBQyxDQUFDLE9BQU8sSUFBSSxJQUFJLFVBQVUsQ0FBQztJQUFDLEdBQUcsR0FBRyxJQUFJLENBQUM7QUFFMUM7SUFBQTtJQU9BLENBQUM7SUFOVSxXQUFJLEdBQVgsVUFBWSxDQUFRO1FBQ2hCLE1BQU0sQ0FBQyxHQUFHLENBQUMsQ0FBQyxDQUFDLENBQUM7SUFDbEIsQ0FBQztJQUNNLFdBQUksR0FBWCxVQUFZLENBQVE7UUFDaEIsTUFBTSxDQUFDLEdBQUcsQ0FBQyxDQUFDLENBQUMsQ0FBQztJQUNsQixDQUFDO0lBQ0wsYUFBQztBQUFELENBUEEsQUFPQyxJQUFBO0FBUFksY0FBTSxTQU9sQixDQUFBOztBQzNCRDs7R0FFRzs7QUFRSCxJQUFJLE1BQU0sR0FBRyxPQUFPLENBQUMsZUFBZSxDQUFDLENBQUM7QUFFdEM7SUFDSTtJQUVBLENBQUM7SUFFTSxVQUFHLEdBQVYs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QyxDQUFDLENBQUMsQ0FBQyxJQUFJLFFBQVEsQ0FBQyxDQUFDLENBQUMsQ0FBQyxLQUFLLElBQUksR0FBRyxDQUFDO29CQUFDLE1BQU0sQ0FBQztZQUNqRCxDQUFDO1lBQ0QsTUFBTSxDQUFDLElBQUksQ0FBQyxDQUFDLENBQUMsQ0FBQztRQUNuQixDQUFDLENBQUMsQ0FBQztRQUVILE1BQU0sQ0FBQyxNQUFNLENBQUM7SUFDbEIsQ0FBQztJQUdMLGFBQUM7QUFBRCxDQWhLQSxBQWdLQyxJQUFBO0FBaEtZLGNBQU0sU0FnS2xCLENBQUE7O0FDdExEOztHQUVHIiwiZmlsZSI6ImNyeXB0YXJzaS5qcyIsInNvdXJjZXNDb250ZW50IjpbIi8qKlxuICogQ3JlYXRlZCBieSBkZWxpYW4gb24gOC8zMC8xNi5cbiAqL1xuXG4vKlxuICogVGhpcyBsaXR0bGUgbW9kdWxlIHNob3VsZCBpbXBsZW1lbnQgQmFzZTY0IGVuY29kaW5nL2RlY29kaW5nIHdpdGggYXV0byBkZXRlY3QgYmV0d2VlbiBub2RlanMgYW5kIGJyb3dzZXJcbiAqL1xuXG4vLyA8cmVmZXJlbmNlIHBhdGg9XCIuL3R5cGluZ3MvaW5kZXguZC50c1wiIC8+XG5cbnZhciBCMkEgPSBmdW5jdGlvbihiOnN0cmluZyk6IHN0cmluZyB7XG4gICAgcmV0dXJuIG5ldyBCdWZmZXIoYikudG9TdHJpbmcoJ2Jhc2U2NCcpO1xufTtcbmlmICh0eXBlb2YgYnRvYSA9PSAnZnVuY3Rpb24nKSBCMkEgPSBidG9hO1xuXG52YXIgQTJCID0gZnVuY3Rpb24oYTpzdHJpbmcpOiBzdHJpbmcge1xuICAgIHJldHVybiBuZXcgQnVmZmVyKGEsJ2Jhc2U2NCcpLnRvU3RyaW5nKCdhc2NpaScpO1xufTtcbmlmICh0eXBlb2YgYXRvYiA9PSAnZnVuY3Rpb24nKSBBMkIgPSBhdG9iO1xuXG5leHBvcnQgY2xhc3MgQmFzZTY0IHtcbiAgICBzdGF0aWMgYnRvYShiOnN0cmluZyk6c3RyaW5nIHtcbiAgICAgICAgcmV0dXJuIEIyQShiKTtcbiAgICB9XG4gICAgc3RhdGljIGF0b2IoYTpzdHJpbmcpOnN0cmluZyB7XG4gICAgICAgIHJldHVybiBBMkIoYSk7XG4gICAgfVxufSIsIi8qKlxuICogQ3JlYXRlZCBieSBkZWxpYW4gb24gOC8zMC8xNi5cbiAqL1xuXG5kZWNsYXJlIHZhciByZXF1aXJlOiB7XG4gICAgPFQ+KHBhdGg6IHN0cmluZyk6IFQ7XG4gICAgKHBhdGhzOiBzdHJpbmdbXSwgY2FsbGJhY2s6ICguLi5tb2R1bGVzOiBhbnlbXSkgPT4gdm9pZCk6IHZvaWQ7XG4gICAgZW5zdXJlOiAocGF0aHM6IHN0cmluZ1tdLCBjYWxsYmFjazogKHJlcXVpcmU6IDxUPihwYXRoOiBzdHJpbmcpID0+IFQpID0+IHZvaWQpID0+IHZvaWQ7XG59O1xuXG52YXIgY29uZmlnID0gcmVxdWlyZSgnLi9jb25maWcuanNvbicpO1xuXG5leHBvcnQgY2xhc3MgQ29uZmlnIHtcbiAgICBjb25zdHJ1Y3RvcigpIHtcblxuICAgIH1cblxuICAgIHN0YXRpYyBnZXQoa2V5OnN0cmluZyk6c3RyaW5nIHtcbiAgICAgICAgcmV0dXJuIGNvbmZpZ1trZXldO1xuICAgIH1cbn1cbiIsIi8qKlxuICogQ3JlYXRlZCBieSBkZWxpYW4gb24gOC8zMC8xNi5cbiAqL1xuXG5leHBvcnQgY2xhc3MgV29yZEhhc2gge1xuICAgIHN0YXRpYyBoYXNoKHdvcmQ6c3RyaW5nKTpzdHJpbmcge1xuICAgICAgICByZXR1cm4gd29yZC50b0xvd2VyQ2FzZSgpLm1hdGNoKC9eLnsyLDE1fS8pWzBdO1xuICAgIH1cblxuICAgIHN0YXRpYyBkMmgoZDpudW1iZXIpOnN0cmluZyB7IC8vIENvbnZlcnQgdG8gSEVYXG4gICAgICAgIHJldHVybiBkLnRvU3RyaW5nKDE2KTtcbiAgICB9XG5cbiAgICBzdGF0aWMgaDJkKGg6c3RyaW5nKTpudW1iZXIgeyAvLyBDb252ZXJ0IHRvIE51bVxuICAgICAgICByZXR1cm4gcGFyc2VJbnQoaCwxNik7XG4gICAgfVxuXG4gICAgc3RhdGljIHMyaChzOiBzdHJpbmcpOnN0cmluZyB7IC8vIFN0cmluZyB0byBIRVhcbiAgICAgICAgdmFyIGNyOnN0cmluZyA9IFwiXCI7XG4gICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgcy5sZW5ndGg7IGkrKykgY3IgPSBjciArIHRoaXMuZDJoKHMuY2hhckNvZGVBdChpKSk7XG4gICAgICAgIHJldHVybiBjcjtcbiAgICB9XG59XG4iLCIvKipcbiAqIENyZWF0ZWQgYnkgZGVsaWFuIG9uIDgvMTkvMTYuXG4gKi9cbi8vLyA8cmVmZXJlbmNlIHBhdGg9XCIuL3R5cGluZ3MvaW5kZXguZC50c1wiIC8+XG5cbmltcG9ydCB7V29yZEhhc2h9IGZyb20gXCIuL1dvcmRIYXNoXCI7XG5cbnZhciBnUGFzc3dvcmQ6c3RyaW5nID0gbnVsbDtcbnZhciBnTm9uY2U6c3RyaW5nID0gbnVsbDtcbi8vIFRPRE86IFRvIGltcGxlbWVudCB0aGUgTm9uY2VcblxuZXhwb3J0IGNsYXNzIENyeXB0byB7XG4gICAgY29uc3RydWN0b3IocGFzc3dvcmQ6IHN0cmluZywgbm9uY2U6IHN0cmluZykge1xuICAgICAgICBnUGFzc3dvcmQgPSBwYXNzd29yZDtcbiAgICB9XG5cbiAgICBoYXNoKHdvcmQ6c3RyaW5nKTpzdHJpbmcge1xuICAgICAgICByZXR1cm4gV29yZEhhc2guaGFzaCh3b3JkKTtcbiAgICB9XG5cbiAgICBkZWNyeXB0KGRhdGE6IHN0cmluZywgcGFzc3dvcmQ6c3RyaW5nID0gZ1Bhc3N3b3JkLCBub25jZTpzdHJpbmcgPSBnTm9uY2UpOiBzdHJpbmcge1xuICAgICAgICByZXR1cm4gQ3J5cHRvSlMuQUVTLmRlY3J5cHQoZGF0YSwgcGFzc3dvcmQpLnRvU3RyaW5nKCk7XG4gICAgfVxuXG4gICAgZW5jcnlwdChkYXRhOiBzdHJpbmcsIHBhc3N3b3JkOnN0cmluZyA9IGdQYXNzd29yZCwgbm9uY2U6c3RyaW5nID0gZ05vbmNlKTogc3RyaW5nIHtcbiAgICAgICAgcmV0dXJuIENyeXB0b0pTLkFFUy5lbmNyeXB0KGRhdGEsIHBhc3N3b3JkKS50b1N0cmluZygpO1xuICAgIH1cblxuICAgIHNldFBhc3N3b3JkKHBhc3N3b3JkOnN0cmluZykge1xuICAgICAgICBnUGFzc3dvcmQgPSBwYXNzd29yZDtcbiAgICB9XG5cbiAgICBzZXROb25jZShub25jZTpzdHJpbmcpIHtcbiAgICAgICAgZ05vbmNlID0gbm9uY2U7XG4gICAgfVxuXG4gICAgZGhzKHdvcmQ6IHN0cmluZyk6IHN0cmluZyB7XG4gICAgICAgIHJldHVybiB0aGlzLmVuY3J5cHQod29yZCk7XG4gICAgfVxufVxuXG4iLCIvKipcbiAqIENyZWF0ZWQgYnkgZGVsaWFuIG9uIDgvMzAvMTYuXG4gKi9cblxuLy8vIDxyZWZlcmVuY2UgcGF0aD1cIi4vdHlwaW5ncy9pbmRleC5kLnRzXCIgLz5cblxuaW1wb3J0IHtDb25maWd9IGZyb20gJy4vQ29uZmlnJztcbmltcG9ydCB7UHJvbWlzZX0gZnJvbSAnZXM2LXByb21pc2UnO1xuXG5leHBvcnQgY2xhc3MgVXJpTG9hZCB7XG4gICAgcmVxOiBYTUxIdHRwUmVxdWVzdCA9IG51bGw7XG5cbiAgICBjb25zdHJ1Y3RvcigpIHtcbiAgICAgICAgdGhpcy5yZXEgPSBuZXcgWE1MSHR0cFJlcXVlc3QoKTtcbiAgICB9XG5cbiAgICBnZXQodXJpOnN0cmluZyk6UHJvbWlzZTxhbnk+IHtcbiAgICAgICAgdmFyIG1lID0gdGhpcztcbiAgICAgICAgcmV0dXJuIG5ldyBQcm9taXNlKGZ1bmN0aW9uKHJlc29sdmUscmVqZWN0KSB7XG4gICAgICAgICAgICBtZS5yZXEub3BlbignR0VUJywgdXJpLCB0cnVlKTtcbiAgICAgICAgICAgIG1lLnJlcS5vbmxvYWQgPSBmdW5jdGlvbihlKSB7XG4gICAgICAgICAgICAgICAgaWYgKG1lLnJlcS5yZWFkeVN0YXRlID09IDQpIHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKG1lLnJlcS5zdGF0dXMgPT0gMjAwIHx8IG1lLnJlcS5zdGF0dXMgPT0gMjAxIHx8IG1lLnJlcS5zdGF0dXMgPT0gMCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgcmVzb2x2ZShtZS5yZXEpXG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9O1xuICAgICAgICAgICAgbWUucmVxLm9uZXJyb3IgPSBmdW5jdGlvbihlKSB7XG4gICAgICAgICAgICAgICAgcmVqZWN0KG1lLnJlcSlcbiAgICAgICAgICAgIH07XG4gICAgICAgICAgICBtZS5yZXEuc2VuZChudWxsKTtcbiAgICAgICAgfSlcbiAgICB9XG59XG4iLCIvKipcbiAqIENyZWF0ZWQgYnkgZGVsaWFuIG9uIDgvMTkvMTYuXG4gKi9cblxuLy8vIDxyZWZlcmVuY2UgcGF0aD1cIi4vdHlwaW5ncy9pbmRleC5kLnRzXCIgLz5cblxuaW1wb3J0IHtVcmlMb2FkfSBmcm9tICcuL1VyaUxvYWQnO1xuaW1wb3J0IHtXb3JkSGFzaH0gZnJvbSAnLi9Xb3JkSGFzaCc7XG5pbXBvcnQge0NyeXB0b30gZnJvbSAnLi9DcnlwdG8nO1xuaW1wb3J0IHtQcm9taXNlfSBmcm9tICdlczYtcHJvbWlzZSc7XG5cbmV4cG9ydCBjbGFzcyBTdG9yYWdlIHtcblxuICAgIG5ldDogVXJpTG9hZDtcbiAgICBjcnlwdG86IENyeXB0bztcblxuICAgIGNvbnN0cnVjdG9yKCkge1xuICAgICAgICB0aGlzLm5ldCA9IG5ldyBVcmlMb2FkKCk7XG4gICAgICAgIHRoaXMuY3J5cHRvID0gbmV3IENyeXB0bygnJywnJyk7IC8vIFRPRE86IEZpeCB0aGUgcGFzc3dvcmRcbiAgICB9XG5cbiAgICBjbGVhcigpIHtcbiAgICAgICAgbG9jYWxTdG9yYWdlLmNsZWFyKCk7XG4gICAgfVxuXG4gICAgbG9hZEZyb21VUkkodXJpKSB7XG4gICAgICAgIHRoaXMuY2xlYXIoKTtcbiAgICB9XG5cbiAgICBnZXREYXRhTFMoa2V5OnN0cmluZyk6IHN0cmluZyB7XG4gICAgICAgIHJldHVybiBsb2NhbFN0b3JhZ2Vba2V5XTtcbiAgICB9XG5cbiAgICBzZXREYXRhTFMoa2V5OnN0cmluZywgdmFsOnN0cmluZyk6c3RyaW5nIHtcbiAgICAgICAgbG9jYWxTdG9yYWdlW2tleV09dmFsO1xuICAgICAgICByZXR1cm4gdmFsO1xuICAgIH1cblxuICAgIGdldERhdGEoa2V5OnN0cmluZyk6UHJvbWlzZTxhbnk+IHtcbiAgICAgICAgdmFyIG1lID0gdGhpcztcbiAgICAgICAgcmV0dXJuIG5ldyBQcm9taXNlKChyZXNvbHZlLCByZWplY3QpID0+IHtcbiAgICAgICAgICAgIHJlc29sdmUobWUuZ2V0RGF0YUxTKGtleSkpO1xuICAgICAgICB9KTtcbiAgICB9XG5cbiAgICBzZXREYXRhKGtleTpzdHJpbmcsIHZhbDpzdHJpbmcpOlByb21pc2U8YW55PiB7XG4gICAgICAgIHZhciBtZSA9IHRoaXM7XG4gICAgICAgIHJldHVybiBuZXcgUHJvbWlzZSgocmVzb2x2ZSwgcmVqZWN0KSA9PiB7XG4gICAgICAgICAgICByZXNvbHZlKG1lLnNldERhdGFMUyhrZXksdmFsKSk7XG4gICAgICAgIH0pO1xuICAgIH1cblxuICAgIGxzdHIoeDogc3RyaW5nLCBjYjogRnVuY3Rpb24pOmJvb2xlYW4geyAvLyBUT0RPOiBsc3RyIG11c3QgYmVjb21lIHdpdGggY2FsbGJhY2tcbiAgICAgICAgdmFyIG15ID0gdGhpcztcbiAgICAgICAgaWYgKHRoaXMuZ2V0RGF0YSh4KSkgcmV0dXJuIHRydWU7XG4gICAgICAgIHZhciBmaWxlID0gV29yZEhhc2guczJoKHgpO1xuICAgICAgICB2YXIgZGlyID0gZmlsZS5zdWJzdHIoLTMsIDMpO1xuICAgICAgICB2YXIgZm4gPSBcImluZGV4L1wiICsgZGlyICsgXCIvZmlsZVwiICsgZmlsZSArIFwiLnR4dFwiO1xuICAgICAgICBuZXQuZ2V0KGZuLGZ1bmN0aW9uKGVycixyZXEpIHtcbiAgICAgICAgICAgIHZhciB6ID0gcmVxLnJlc3BvbnNlVGV4dDtcbiAgICAgICAgICAgIG15LnNldERhdGEoeCx6LnJlcGxhY2UoL1xcPHhtbFxcPi8sIFwiXCIpLnJlcGxhY2UoL1xcPFxcL3htbFxcPi8sIFwiXCIpKTtcbiAgICAgICAgICAgIGlmIChteS5nZXREYXRhKHgpKSByZXR1cm4gY2IobnVsbCk7XG4gICAgICAgICAgICByZXR1cm4gY2IobmV3IEVycm9yKCkpO1xuICAgICAgICB9KTtcbiAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH1cblxuICAgIHNldGV4dHIodzogc3RyaW5nLCBjYjpGdW5jdGlvbik6dm9pZCB7XG4gICAgICAgIHZhciBkID0gY3J5cHRvLmRocyh3ICsgXCIuaWR4XCIpO1xuICAgICAgICB0aGlzLmxzdHIoZCxmdW5jdGlvbihlcnIsZGF0YSkge1xuICAgICAgICAgICAgaWYgKGVycikgY2IoZXJyLFtdKTtcbiAgICAgICAgICAgIHZhciBzID0gY3J5cHRvLmRlY3J5cHQodGhpcy5nZXREYXRhKGQpKTsgLy8gVE9ETzogU3RvcmFnZSBoYXMgdG8gYmVjb21lIGFzeW5jXG4gICAgICAgICAgICByZXR1cm4gY2IobnVsbCxzLnNwbGl0KFwiLFwiKSk7XG4gICAgICAgIH0pO1xuICAgIH1cblxufVxuIiwiLyoqXG4gKiBDcmVhdGVkIGJ5IGRlbGlhbiBvbiAxMC8yLzE2LlxuICovXG5cbi8vLyA8cmVmZXJlbmNlIHBhdGg9XCIuL3R5cGluZ3MvaW5kZXguZC50c1wiIC8+XG5cblxuLypcblRoaXMgY2xhc3MgaGFzIGEgZ29hbCB0byBsb2FkIHRoZSBkYXRhYmFzZSBpbiB0aGUgc3RvcmFnZVxuICovXG5cbi8vIFRPRE86IG1ha2UgdGhlIGNvZGUgbW9yZSBzZXF1ZW50aWFsIHdpdGggUHJvbWlzZXMuIENvdWxkIHVzZSBQcm9taXNlcy5hbGxcblxuaW1wb3J0IHtVcmlMb2FkfSBmcm9tICcuL1VyaUxvYWQnO1xuaW1wb3J0IHtTdG9yYWdlfSBmcm9tICcuL1N0b3JhZ2UnO1xuaW1wb3J0IHtQcm9taXNlfSBmcm9tICdlczYtcHJvbWlzZSc7XG5cbmNsYXNzIExvYWREQiB7XG4gICAgdXJpUmVxOiBVcmlMb2FkO1xuICAgIHN0b3JhZ2U6IFN0b3JhZ2U7XG5cbiAgICBjb25zdHJ1Y3RvcigpIHtcbiAgICAgICAgdGhpcy51cmlSZXEgPSBuZXcgVXJpTG9hZCgpO1xuICAgICAgICB0aGlzLnN0b3JhZ2UgPSBuZXcgU3RvcmFnZSgpO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIExvYWRzIGRhdGEgZnJvbSBhIHByZWRlZmluZWQgVVJMIGFuZCBzdG9yZXMgaXQgaW4gdGhlIHN0b3JhZ2VcbiAgICAgKiBAcGFyYW0gdXJpXG4gICAgICogQHJldHVybnMge1wiZXM2LXByb21pc2VcIi5Qcm9taXNlfVxuICAgICAqL1xuICAgIGxvYWQodXJpOnN0cmluZyk6UHJvbWlzZTxhbnk+IHtcbiAgICAgICAgdmFyIG1lID0gdGhpcztcbiAgICAgICAgcmV0dXJuIG5ldyBQcm9taXNlKGZ1bmN0aW9uKHJlc29sdmUsIHJlamVjdCkge1xuICAgICAgICAgICAgbWUudXJpUmVxLmdldCh1cmkpLnRoZW4oZnVuY3Rpb24ocmVxKSB7XG4gICAgICAgICAgICAgICAgdmFyIHJlc3AgPSByZXEucmVzcG9uc2VYTUwuZG9jdW1lbnRFbGVtZW50O1xuICAgICAgICAgICAgICAgIHZhciBmaWVsZCA9IHJlc3AuZ2V0RWxlbWVudHNCeVRhZ05hbWUoXCJkYXRhXCIpO1xuICAgICAgICAgICAgICAgIGZvciAodmFyIGk9MDsgaTxmaWVsZC5sZW5ndGg7IGkrKykge1xuICAgICAgICAgICAgICAgICAgICB0cnkge1xuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGtleTogc3RyaW5nID0gZmllbGRbaV0uZ2V0RWxlbWVudHNCeVRhZ05hbWUoXCJrZXlcIilbMF0udGV4dENvbnRlbnQ7XG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgdmFsOiBzdHJpbmcgPSBmaWVsZFtpXS5nZXRFbGVtZW50c0J5VGFnTmFtZShcInZhbHVlXCIpWzBdLnRleHRDb250ZW50O1xuICAgICAgICAgICAgICAgICAgICAgICAgbWUuc3RvcmFnZS5zZXREYXRhKGtleSwgdmFsKS5jYXRjaChyZWplY3QpOyAvLyBObyBwcm9ibGVtIGl0IGNvdWxkIGV4ZWN1dGUgb3V0IG9mIG9yZGVyXG4gICAgICAgICAgICAgICAgICAgIH0gY2F0Y2goZSkgeyB9XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIHJldHVybiByZXNvbHZlKCk7XG4gICAgICAgICAgICB9KS5jYXRjaChyZWplY3QpO1xuICAgICAgICB9KTtcbiAgICB9XG59IiwiLyoqXG4gKiBDcmVhdGVkIGJ5IGRlbGlhbiBvbiA4LzE5LzE2LlxuICovXG5cbmltcG9ydCB7Q3J5cHRvfSBmcm9tICcuL0NyeXB0byc7XG5pbXBvcnQge1N0b3JhZ2V9IGZyb20gJy4vU3RvcmFnZSc7XG5pbXBvcnQge1dvcmRIYXNofSBmcm9tICcuL1dvcmRIYXNoJztcblxudmFyIGNyeXB0ID0gbmV3IENyeXB0bygncGFyb2xhJywnbm9uY2UnKTsgLy9UT0RPOiBwYXNzd29yZCBzdG9yZVxudmFyIHN0b3JhZ2UgPSBuZXcgU3RvcmFnZSgpO1xuXG5pbnRlcmZhY2UgSUFuZE5vdCB7XG4gICAgbm90OiBhbnksXG4gICAgYW5kOiBhbnlcbn1cblxuaW50ZXJmYWNlIElQdXNoQSB7XG4gICAgbWF0Y2g6IGFueSxcbiAgICBzdHJpbmc6IHN0cmluZyxcbiAgICByZWdleD86IGFueVxufVxuXG5leHBvcnQgY2xhc3MgU2VhcmNoIHtcbiAgICBjb25zdHJ1Y3RvcigpIHtcblxuICAgIH1cblxuICAgIGNyb3Nzc2V0KHc6IHN0cmluZ1tdLCBzOiBzdHJpbmdbXSk6IHN0cmluZ1tdIHtcbiAgICAgICAgbGV0IGE6IHN0cmluZ1tdID0gW107XG4gICAgICAgIGZvciAobGV0IGk6bnVtYmVyID0gcy5sZW5ndGgtMTsgaT49MDsgaS0tKSBpZiAody5pbmRleE9mKHNbaV0pPj0wKSBhLnB1c2goc1tpXSk7XG4gICAgICAgIHJldHVybiBhO1xuICAgIH1cblxuICAgIG5vdGNyb3Nzc2V0KHc6IHN0cmluZ1tdLCBzOiBzdHJpbmdbXSk6IHN0cmluZ1tdIHtcbiAgICAgICAgbGV0IGE6IHN0cmluZ1tdID0gdztcbiAgICAgICAgZm9yIChsZXQgaTpudW1iZXIgPSBzLmxlbmd0aC0xOyBpID49IDA7IGktLSkgaWYgKGEuaW5kZXhPZihzW2ldKT49MCkgYS5zcGxpY2UoYS5pbmRleE9mKHNbaV0pLDEpO1xuICAgICAgICByZXR1cm4gYTtcbiAgICB9XG5cbiAgICBhbmROb3Qod29yZHM6IHN0cmluZywgaXNudDogYm9vbGVhbiA9IGZhbHNlKTogSUFuZE5vdCB7XG5cbiAgICAgICAgZnVuY3Rpb24gYnJhbmNoTGVuKHRleHQ6IHN0cmluZyk6IG51bWJlciB7XG4gICAgICAgICAgICB2YXIgd29yZHM6IHN0cmluZyA9IHRleHQucmVwbGFjZSgvXlxccysvLCBcIlwiKS5yZXBsYWNlKC9cXHMrJC8sIFwiXCIpO1xuICAgICAgICAgICAgdmFyIGk6IG51bWJlcjtcbiAgICAgICAgICAgIHZhciBjb3VudDogbnVtYmVyO1xuXG4gICAgICAgICAgICBpZiAod29yZHMuY2hhckF0KDApIT0nKCcpIHJldHVybiB0ZXh0Lmxlbmd0aDtcbiAgICAgICAgICAgIGZvciAoaT0xLGNvdW50PTE7IGNvdW50JiZpPHdvcmRzLmxlbmd0aDsgaSsrKSB7XG4gICAgICAgICAgICAgICAgY291bnQrPSh3b3Jkcy5jaGFyQXQoaSk9PScoJyk/MTowO1xuICAgICAgICAgICAgICAgIGNvdW50LT0od29yZHMuY2hhckF0KGkpPT0nKScpPzE6MDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHJldHVybiBpO1xuICAgICAgICB9XG5cbiAgICAgICAgZnVuY3Rpb24gbWl4b3V0KGE6SUFuZE5vdCxiOklBbmROb3QpOklBbmROb3Qge1xuICAgICAgICAgICAgaWYgKHR5cGVvZiBhICE9ICdvYmplY3QnIHx8IHR5cGVvZiBiICE9ICdvYmplY3QnIHx8IHR5cGVvZiBhLmFuZCAhPSAnb2JqZWN0JyB8fCB0eXBlb2YgYS5ub3QgIT0gJ29iamVjdCcgfHwgdHlwZW9mIGIuYW5kICE9ICdvYmplY3QnIHx8IHR5cGVvZiBiLm5vdCAhPSAnb2JqZWN0JykgcmV0dXJuIGE7XG4gICAgICAgICAgICBPYmplY3Qua2V5cyhiLmFuZCkuZm9yRWFjaChmdW5jdGlvbihuKSB7YS5hbmRbbl09IGIuYW5kW25dfSk7XG4gICAgICAgICAgICBPYmplY3Qua2V5cyhiLm5vdCkuZm9yRWFjaChmdW5jdGlvbihuKSB7YS5ub3Rbbl09IGIubm90W25dfSk7XG4gICAgICAgICAgICByZXR1cm4gYTtcbiAgICAgICAgfVxuXG4gICAgICAgIHZhciBvdXQ6SUFuZE5vdDtcbiAgICAgICAgdmFyIG91dDI6SUFuZE5vdDtcbiAgICAgICAgaWYgKHR5cGVvZiB3b3JkcyAhPSAnc3RyaW5nJyB8fCB3b3JkcyA9PSAnJykgcmV0dXJuIHsgYW5kOiB7fSwgbm90OiB7fSB9O1xuXG4gICAgICAgIHdvcmRzID0gd29yZHMucmVwbGFjZSgvXlxccysvLCBcIlwiKS5yZXBsYWNlKC9cXHMrJC8sIFwiXCIpO1xuICAgICAgICBpZiAod29yZHMubGVuZ3RoPT0wKSByZXR1cm4geyBhbmQ6IHt9LCBub3Q6IHt9IH07XG4gICAgICAgIC8vY29uc29sZS5sb2coJ1dvcmRzJyx3b3Jkcyk7XG5cbiAgICAgICAgaWYgKHdvcmRzLmNoYXJBdCgwKSA9PSAnKCcpIHtcbiAgICAgICAgICAgIHZhciBibGVuID0gYnJhbmNoTGVuKHdvcmRzKTtcbiAgICAgICAgICAgIHZhciBteXNldCA9IHdvcmRzLnN1YnN0cigwLGJsZW4pO1xuICAgICAgICAgICAgdmFyIG91dHNldCA9IHdvcmRzLnN1YnN0cihibGVuKTtcbiAgICAgICAgICAgIG15c2V0ID0gbXlzZXQucmVwbGFjZSgvXlxcKC8sXCJcIikucmVwbGFjZSgvXFwpJC8sXCJcIik7XG4gICAgICAgICAgICBvdXQgPSB0aGlzLmFuZE5vdChteXNldCk7XG4gICAgICAgICAgICBvdXQyID0gdGhpcy5hbmROb3Qob3V0c2V0KTtcbiAgICAgICAgICAgIHJldHVybiBtaXhvdXQoaXNudD97IGFuZDogb3V0Lm5vdCwgbm90OiBvdXQuYW5kIH06b3V0LG91dDIpO1xuICAgICAgICB9XG5cbiAgICAgICAgaWYgKHdvcmRzLmNoYXJBdCgwKSA9PSAnLScpIHsgLy8gSW52ZXJzZVxuICAgICAgICAgICAgcmV0dXJuIHRoaXMuYW5kTm90KHdvcmRzLnN1YnN0cigxKSxpc250P2ZhbHNlOnRydWUpO1xuICAgICAgICB9XG5cbiAgICAgICAgaWYgKHdvcmRzLmNoYXJBdCgwKSA9PSAnKycpIHJldHVybiB0aGlzLmFuZE5vdCh3b3Jkcy5zdWJzdHIoMSksaXNudCk7XG5cbiAgICAgICAgdmFyIHggPSB3b3Jkcy5tYXRjaCgvXihcXFMrKSguKyk/JC8pO1xuICAgICAgICB2YXIgeSA9IHt9O1xuICAgICAgICBpZiAoeD09bnVsbCkgcmV0dXJuIHsgYW5kOiB7fSwgbm90OiB7fSB9O1xuICAgICAgICB5W3hbMV1dPTE7XG4gICAgICAgIHJldHVybiBtaXhvdXQoaXNudD97IGFuZDoge30gLCBub3Q6IHkgfTp7IGFuZDogeSwgbm90OiB7fSB9LHRoaXMuYW5kTm90KHhbMl0pKTtcbiAgICB9XG5cbiAgICBjb1JlZ2V4UHJvYyh3b3JkczpzdHJpbmcpOklQdXNoQVtdIHtcbiAgICAgICAgaWYgKHR5cGVvZiB3b3JkcyAhPSAnc3RyaW5nJyB8fCB3b3JkcyA9PSAnJykgcmV0dXJuIFtdO1xuICAgICAgICB3b3JkcyA9IHdvcmRzLnJlcGxhY2UoL15cXHMrLywgXCJcIikucmVwbGFjZSgvXFxzKyQvLCBbXSk7XG4gICAgICAgIGlmICh3b3Jkcy5sZW5ndGg9PTApIHJldHVybiBbXTtcblxuICAgICAgICBmdW5jdGlvbiByZWdleEFycmF5KHdvcmRzOnN0cmluZyk6SVB1c2hBW10ge1xuICAgICAgICAgICAgdmFyIHc6c3RyaW5nID0gd29yZHM7XG4gICAgICAgICAgICB2YXIgcHVzaEE6SVB1c2hBW10gPSBbXTtcblxuICAgICAgICAgICAgZnVuY3Rpb24gc3BsaXRQdXNoKHdvcmRzOnN0cmluZyxpbnY6Ym9vbGVhbj1mYWxzZSk6dm9pZCB7XG4gICAgICAgICAgICAgICAgd2hpbGUod29yZHMubWF0Y2goL1tcXCtcXC1dLykpIHtcbiAgICAgICAgICAgICAgICAgICAgd29yZHMgPSB3b3Jkcy5yZXBsYWNlKC9eXFxzKy8sXCJcIikucmVwbGFjZSgvXFxzKyQvLFwiXCIpO1xuICAgICAgICAgICAgICAgICAgICBpZiAoIXdvcmRzLm1hdGNoKC9eW1xcK1xcLV0vKSkgd29yZHMgPSB3b3Jkcy5yZXBsYWNlKC9eKC4rPykoW1xcK1xcLV0pLyxmdW5jdGlvbihtLGEscCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgcHVzaEEucHVzaCh7IG1hdGNoOiBpbnY/XCItXCI6XCIrXCIsIHN0cmluZzogYSB9KTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBwO1xuICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICAgICAgd29yZHMgPSB3b3Jkcy5yZXBsYWNlKC9eKFtcXCtcXC1dKShcXFMrKT8vLGZ1bmN0aW9uKG0scCxhKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBwdXNoQS5wdXNoKHsgbWF0Y2g6ICgoKGludj8xOjApXihwIT0nLSc/MTowKSk/XCIrXCI6XCItXCIpLCBzdHJpbmc6IGF9KTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBcIlwiO1xuICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgaWYgKHdvcmRzKSBwdXNoQS5wdXNoKHttYXRjaDooaW52P1wiLVwiOlwiK1wiKSwgc3RyaW5nOndvcmRzfSk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGZ1bmN0aW9uIGJyYW5jaGVzKCkge1xuICAgICAgICAgICAgICAgIHc9dy5yZXBsYWNlKC8oW1xcK1xcLV0/KVxcKCguKz8pXFwpL2csZnVuY3Rpb24obSxwLGEpIHtcbiAgICAgICAgICAgICAgICAgICAgc3BsaXRQdXNoKGEscD09Jy0nKTtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIFwiXCI7XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGJyYW5jaGVzKCk7XG4gICAgICAgICAgICBzcGxpdFB1c2godyk7XG5cbiAgICAgICAgICAgIHB1c2hBLmZvckVhY2goZnVuY3Rpb24obikge24uc3RyaW5nID0gbi5zdHJpbmcucmVwbGFjZSgvXlxccysvLFwiXCIpLnJlcGxhY2UoL1xccyskLyxcIlwiKS5yZXBsYWNlKC9bXFxzXFwhLVxcL1xcOi1cXEBcXFstXFxdXFwnXFx7LX5dKy9nLFwiLipcIik7bi5yZWdleCA9IG5ldyBSZWdFeHAobi5zdHJpbmcsXCJpXCIpOyB9KTtcblxuICAgICAgICAgICAgcmV0dXJuIHB1c2hBO1xuICAgICAgICB9XG5cbiAgICAgICAgcmV0dXJuIHJlZ2V4QXJyYXkod29yZHMpO1xuICAgIH1cblxuICAgIHNlYXJjaFJ1bGUoc3JjaDogc3RyaW5nKTogc3RyaW5nW10ge1xuICAgICAgICB2YXIgb3V0ID0gdGhpcy5hbmROb3Qoc3JjaCk7XG5cbiAgICAgICAgaWYgKE9iamVjdC5rZXlzKG91dC5hbmQpLmxlbmd0aD09MCkgcmV0dXJuIFtdO1xuICAgICAgICB2YXIgdyA9IE9iamVjdC5rZXlzKG91dC5hbmQpLmNvbmNhdChPYmplY3Qua2V5cyhvdXQubm90KSkuc29ydCgoeDpzdHJpbmcseTpzdHJpbmcpOm51bWJlcj0+eyByZXR1cm4geC5sZW5ndGg8PXkubGVuZ3RoPzE6MCB9KTtcbiAgICAgICAgdmFyIHcxID0gT2JqZWN0LmtleXMob3V0LmFuZCkuc29ydCgoeDpzdHJpbmcseTpzdHJpbmcpOm51bWJlcj0+eyByZXR1cm4geC5sZW5ndGg8PXkubGVuZ3RoPzE6MCB9KTtcblxuICAgICAgICB3LnVuc2hpZnQody5zcGxpY2Uody5pbmRleE9mKHcxWzBdKSwxKVswXSk7IC8vIFB1dCB0aGUgbGFyZ2VzdCBBTkQgd29yZCBhdCB0aGUgZnJvbnRcblxuICAgICAgICB2YXIgbXlzZXQgPSBzdG9yYWdlLnNldGV4dHIoV29yZEhhc2guaGFzaCh3WzBdKSxmdW5jdGlvbigpIHtcblxuICAgICAgICB9KTtcbiAgICAgICAgZm9yIChsZXQgaTpudW1iZXIgPSAxOyBpIDwgdy5sZW5ndGggICYmIChteXNldC5sZW5ndGggPj0gKHcubGVuZ3RoLWkpKTsgaSsrKSBteXNldCA9IChvdXQuYW5kW3dbaV1dKT9jcm9zc3NldChteXNldCwgc2V0ZXh0cihteWhhc2god1tpXSkpKTpub3Rjcm9zc3NldChteXNldCwgc2V0ZXh0cihteWhhc2god1tpXSkpKTtcblxuICAgICAgICAvLyBOb3cgd2UgaGF2ZSBhIHNldCB3aXRoIHByb2JhYmxlIG1hdGNoaW5nLCBsZXRzIGRvIHRoZSBzZWNvbmQgbWF0Y2hcblxuICAgICAgICB2YXIgb3V0c2V0ID0gW107XG4gICAgICAgIHZhciByZWdBcnJheSA9IHRoaXMuY29SZWdleFByb2Moc3JjaCk7XG5cbiAgICAgICAgdmFyIGZ1bGxTdHJpbmdzID0gc3JjaC5tYXRjaCgvKFtcXCtcXC1dKT9cXFwiKC4rPylcXFwiL2cpO1xuICAgICAgICBpZiAoZnVsbFN0cmluZ3MpIHtcbiAgICAgICAgICAgIGZ1bGxTdHJpbmdzLmZvckVhY2goZnVuY3Rpb24obikge1xuICAgICAgICAgICAgICAgIHZhciBvOklQdXNoQSA9IHsgbWF0Y2g6ICcrJywgc3RyaW5nOiAnJyB9O1xuICAgICAgICAgICAgICAgIGlmIChuLm1hdGNoKC9eXFwtLykpIG8ubWF0Y2ggPSAnLSc7XG4gICAgICAgICAgICAgICAgby5zdHJpbmcgPSBuLnJlcGxhY2UoL15bXFwrXFwtXT9cXFwiLyxcIlwiKS5yZXBsYWNlKC9cXFwiJC8sXCJcIikucmVwbGFjZSgvW1xcc1xcIS1cXC9cXDotXFxAXFxbLVxcXVxcJ1xcey1+XSsvZyxcIltcXFxcc1xcXFwhLVxcXFwvXFxcXDotXFxcXEBcXFxcWy1cXFxcXVxcXFwnXFxcXHstfl0qXCIpO1xuICAgICAgICAgICAgICAgIG8ucmVnZXggPSBuZXcgUmVnRXhwKG8uc3RyaW5nLFwiaVwiKTtcbiAgICAgICAgICAgICAgICByZWdBcnJheS51bnNoaWZ0KG8pO1xuICAgICAgICAgICAgfSlcbiAgICAgICAgfVxuXG4gICAgICAgIG15c2V0LmZvckVhY2goZnVuY3Rpb24obikge1xuICAgICAgICAgICAgdmFyIHMgPSB0cmQobitcIi5kYXRhXCIpO1xuXG4gICAgICAgICAgICAvLyBTdGluZ3MgbWF0Y2hcblxuXG4gICAgICAgICAgICBmb3IgKHZhciBpPTA7aTxyZWdBcnJheS5sZW5ndGg7aSsrKSB7XG4gICAgICAgICAgICAgICAgdmFyIHQgPSByZWdBcnJheVtpXS5yZWdleC50ZXN0KHMpO1xuICAgICAgICAgICAgICAgIGlmICh0ICYmIHJlZ0FycmF5W2ldLm1hdGNoID09ICctJykgcmV0dXJuO1xuICAgICAgICAgICAgICAgIGlmICgoIXQpICYmIHJlZ0FycmF5W2ldLm1hdGNoID09ICcrJykgcmV0dXJuO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgb3V0c2V0LnB1c2gobik7XG4gICAgICAgIH0pO1xuXG4gICAgICAgIHJldHVybiBvdXRzZXQ7XG4gICAgfVxuXG5cbn0iLCIvKipcbiAqIENyZWF0ZWQgYnkgZGVsaWFuIG9uIDgvMTgvMTYuXG4gKi9cbiJdfQ==
